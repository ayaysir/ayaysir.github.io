---
published: false
title: "Vue.js: ATM 기초 예제"
date: 2019-01-15
categories: 
  - "none"
tags: 
  - "vue-js"
---

Java로 만들었던 ATM([http://y1oonbumtae.com/?p=623](http://y1oonbumtae.com/?p=623)) 을 Vue.js 를 기반으로 해서

기능을 그대로 재현해보기로 했다.

원래는 그냥 콘솔로 만들어져 있었으나 Vue.js는 웹 프론트엔드 언어이므로

약간의 비주얼(?)은 추가하였음

자바에서는 매우 간단한 예제였으나

Vue.js로 옮겨가면서 굉장히 복잡해져서 생각외로 시간을 많이 잡아먹었다.

이게 차세대 웹 프레임워크들이 의도하는 방향인지는 모르겠으나 이제 막 시작한 입장이므로

그래도 이것저것 써보려 노력은 했다.

그리고 이번 예제는 의도적으로 Jquery를 배제했다.

Jquery를 쓸 수 있다면 그냥 처음부터 Jquery로 시작하는게 훨씬 낫다고 생각하므로..

전체 코드는 링크([https://gist.github.com/ayaysir/95a676cf5720604e0f337ca4ceb64f65](https://gist.github.com/ayaysir/95a676cf5720604e0f337ca4ceb64f65))

테스트 페이지는 [http://y1oonbumtae.com/util/atm](http://y1oonbumtae.com/util/atm)

```
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script>
      var global = new Vue({
          data: {
              prevDisplayWindow: "",
              currentDisplayWindow: "mainMenu",
              currentDeposit: 0
          },
          methods: {
              changeWindow: function(windowName){
                  this.prevDisplayWindow = this.currentDisplayWindow
                  this.currentDisplayWindow = windowName;
              },
              callPrevWindow: function(){
                  var temp = this.currentDisplayWindow
                  this.currentDisplayWindow = this.prevDisplayWindow
                  this.prevDisplayWindow = temp
              }
          }
      })
```

Vue.js CDN 가져오기 및 전역 변수를 설정하는 기능이다. console.log(global.currentDisplayWindow)의 결과는 mainMenu이다. methods는 vue 객체 안에 메소드(함수)를 집어넣는 것으로 추후 설명

 

```js
var mainMenu = new Vue({
               el: '#mainMenu',
               data: {
                   title: "어린이은행 ATM",
                   currentDisplayWindow: "mainMenu",
                   menus: [
                       {title:"입금", action:deposit},
                       {title:"출금", action:withdraw},
                       {title:"조회", action:inquiry},
                       ]
               }
           })
```

ATM의 맨 처음 화면을 구성하는 요소를 menus와 같은 배열로 만든 다음 나중에 꺼내쓸 수 있다.

 

```
        var bank = new Vue({
            methods: {
               displayDeposit: function(menu){
                   loadingWindow.isLoading = true;  // 로딩 이미지 시작
                        var xmlhttp;  
                        if (window.XMLHttpRequest) {  
                            xmlhttp = new XMLHttpRequest();
                        } 
                        else {  
                            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                        }
                        xmlhttp.onreadystatechange = function() {  
                            
                            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                                
                                if(menu === 'input'){
                                    global.changeWindow("messageWindow")
                                    messageWindow.successMessage = "입금이 완료되었습니다."                                    
                                } else if(menu == 'output'){
                                    global.changeWindow("messageWindow")
                                    messageWindow.successMessage = "출금이 완료되었습니다."  
                                } else if(menu == 'init'){
                                    console.log("초기화", xmlhttp.responseText)                                    
                                }
                                // 거래시마다 잔액 갱신되도록
                                global.currentDeposit = parseFloat(xmlhttp.responseText)
                                messageWindow.depositMessage = "잔액: ￦" + numberWithCommas(parseFloat(xmlhttp.responseText)) 
                                loadingWindow.isLoading = false;  // 로딩 이미지 끝
                            } 
                        }
                        xmlhttp.open("POST", "ajaxpage", true);  
                        xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                        xmlhttp.send("prompt=select");  
                   
                 },
                inOutDeposit: function(menu, value){
(........ 이하 생략............)
```

bank 인스턴스는 은행 거래 중계와 잔액을 조회하는 역할을 하며 이번 예제는 비동기적 관점에서 완전히 박살이 난지라 더러운 코드가 나왔지만 원래는 함수의 작동 순서를 생각하면서 짤 필요가 있음. 이 부분을 요약하자면 AJAX와 POST 방식의 리퀘스트를 통해 조회하거나 입출금을 한다.

```js
var inputWindow = new Vue({
    el: '.inputWindow',
    data: {
        menuId: "",
        isWindowOn: false,
        title: "제목",
        description: "설명",
        value: "",
        depositOKMessage: "",
        deposit: ""
        
    },
    methods: {
        inputValue: function (ev) {
            console.log(this.menuId)
            
            bank.inOutDeposit(this.menuId, this.value)
        },
        closeWindow: function(ev){
            console.log(ev)
            global.callPrevWindow();
            
        },
        
        stop: function(ev){
            console.log(this.value)
            this.value = Math.floor(this.value)
        }
    }
})
```

가상 DOM을 만들어서 웹 페이지를 조작한다고 해서... 아직 잘 모르겠지만 그걸 흉내라도 내보려고 했다. DIV는 메시지를 띄우는 거, 입출금 화면 정도만 만들고 데이터를 이리저리 바꿔가면서 화면을 바꾸고자 했다. HTML 코드 참조

 

```js
// http://fruitdev.tistory.com/160
function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}
```

이거는 숫자를 세 자리씩 콤마로 끊어 보여주는 정규식인데 인터넷에서 퍼왔음

 

```html
<body>
    <div id=mainMenu v-if="global.currentDisplayWindow === 'mainMenu'">
        <h3>{{ title }}</h3>
        <ol>
            <li v-for="menu in menus">
                <a href="#" v-on:click="menu.action">{{ menu.title }}</a>
            </li>

        </ol>
    </div>
    <div v-if="global.currentDisplayWindow === 'inputWindow'" class=inputWindow>
        <!--아이디는 바뀔 수 있다는 것을 전제로 함-->
        <h3>{{title}}</h3>
        <p>{{description}}</p>
        <p><input id=inputValueField type=number v-model="value" v-on:keydown.13="inputValue" v-on:keydown.45.46.62.69.95.109.190.189.prevent="stop" start=0 step=100>
            <button type=button v-on:click="inputValue">전송</button>
            <button type=button v-on:click="closeWindow">돌아가기</button></p>

    </div>

    <div v-if="global.currentDisplayWindow === 'messageWindow'" class="messageWindow">
        <h3>{{title}}</h3>
        <p>{{successMessage}}</p>
        <p>{{depositMessage}}</p>
        <button type=button v-on:click="goToMain">메인 메뉴로 돌아가기</button>
    </div>
    <div id=loadingOverlay v-if="isLoading">
        <img src='img/loading.gif'> 로딩중입니다. 기다려주세요..!!
    </div>
</body>
```

메인 화면은 v-for 문으로 배열을 꺼내 반복하고 입출금 화면은 inputWindow, 메시지 출력 화며은 messageWindow를 번갈아가며 사용한다.

인풋필드에서 v-on:keydown.45.46.62...prevent="stop" 메소드는 키보드 코드 45, 46 등을 눌렀을 때 원래 동작을 차단(prevent)하며 stop 메소드를 실행하겠다는 의미로, 특정 키보드의 입력을 차단하고자 할때 쓰면 된다.
