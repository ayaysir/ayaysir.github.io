# Tuner

`Tuner.swift` íŒŒì¼ì€ AudioKitì„ í™œìš©í•œ íŠœë„ˆ(Tuner) ê¸°ëŠ¥ì„ SwiftUIë¡œ êµ¬í˜„í•œ ì˜ˆì œìž…ë‹ˆë‹¤. í•µì‹¬ ì—­í• ì€ ë§ˆì´í¬ ìž…ë ¥ì„ ë°›ì•„ í•´ë‹¹ ì†Œë¦¬ì˜ **ì£¼íŒŒìˆ˜(Pitch)** ì™€ **ì§„í­(Amplitude)** ì„ ì¸¡ì •í•˜ê³ , í˜„ìž¬ ìŒì´ ì–´ë–¤ ìŒê³„(Note)ì¸ì§€ íŒë‹¨í•˜ì—¬ ì‚¬ìš©ìžì—ê²Œ ì•Œë ¤ì£¼ëŠ” ê²ƒìž…ë‹ˆë‹¤.

---

## ðŸ§© **`TunerConductor` í´ëž˜ìŠ¤ ì„¤ëª…**

`TunerConductor`ëŠ” ì˜¤ë””ì˜¤ ì²˜ë¦¬ì˜ ì¤‘ì‹¬ì´ ë˜ëŠ” `ObservableObject`ë¡œ, AudioKitì˜ ì˜¤ë””ì˜¤ ê·¸ëž˜í”„ êµ¬ì„±ê³¼ ì‹¤ì‹œê°„ í”¼ì¹˜ ë¶„ì„ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

### ì£¼ìš” ë³€ìˆ˜ì™€ ì—­í• 

| ë³€ìˆ˜             | ì„¤ëª…                                             |
| -------------- | ---------------------------------------------- |
| `engine`       | AudioKitì˜ ì˜¤ë””ì˜¤ ì—”ì§„. ì „ì²´ ì˜¤ë””ì˜¤ íë¦„ì˜ ì‹œìž‘ì                |
| `mic`          | ë§ˆì´í¬ ìž…ë ¥ (`engine.input`)                        |
| `tappableNode` | `Fader` ë…¸ë“œ 3ê°œ(A, B, C)ë¡œ êµ¬ì„±ëœ ì²´ì¸. ê°ê° ë¶„ì„/ì‹œê°í™” ëª©ì    |
| `silence`      | ìµœì¢… ì¶œë ¥ ë…¸ë“œ. `gain: 0`ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ì‹¤ì œ ì˜¤ë””ì˜¤ ì¶œë ¥ì€ ì—†ìŒ       |
| `tracker`      | `PitchTap` ê°ì²´. ì‹¤ì‹œê°„ í”¼ì¹˜(Pitch)ì™€ ì§„í­(Amplitude) ì¶”ì  |
| `noteInfos`    | 12ë°˜ìŒ ìŒê³„ì˜ ê¸°ì¤€ ì£¼íŒŒìˆ˜ì™€ ìŒ ì´ë¦„ ì •ë³´ í¬í•¨                    |

### ë…¸ë“œ ì—°ê²° êµ¬ì¡° (í”Œë ˆì¸ í…ìŠ¤íŠ¸ ê·¸ë¦¼)

```
[Mic Input] â†’ [Fader A] â†’ [Fader B] â†’ [Fader C] â†’ [Silence (gain: 0)]
                     â†‘         â†‘         â†‘
                RollingView  OutputView  FFTView
```

---

### ìž‘ë™ ë°©ì‹

1. **ìž…ë ¥**

   * `engine.input`ì„ í†µí•´ ë§ˆì´í¬ ìž…ë ¥ì„ ë°›ê³  ì´ë¥¼ `Fader`ì— ì—°ê²°í•©ë‹ˆë‹¤.
   * `PitchTap(mic)` ì€ ë§ˆì´í¬ ìž…ë ¥ì„ tap(ì˜¤ë””ì˜¤ ì‹ í˜¸ ë¼ì¸ ì¤‘ê°„ì— ì—°ê²°í•´ì„œ ê°ì‹œ(listen)í•˜ëŠ” ë™ìž‘) í•˜ì—¬ ì‹¤ì‹œê°„ í”¼ì¹˜ì™€ ì§„í­ì„ ì¸¡ì •í•©ë‹ˆë‹¤.

2. **ë…¸ë“œ ì²´ì¸ êµ¬ì„±**

   * Fader A â†’ B â†’ C ëŠ” ë™ì¼í•œ ì˜¤ë””ì˜¤ ì‹ í˜¸ë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ê°ê¸° ë‹¤ë¥¸ ì‹œê°í™” ë·°ì— ì „ë‹¬í•©ë‹ˆë‹¤.
   * `silence` ë…¸ë“œëŠ” ì¶œë ¥ì´ ì‹¤ì œ ìž¬ìƒë˜ì§€ ì•Šë„ë¡ ì„¤ì • (`gain = 0`).

3. **ì£¼íŒŒìˆ˜ ë¶„ì„**

   * `update(_:_:):` ë©”ì„œë“œëŠ” `PitchTap`ì—ì„œ ë°›ì€ í”¼ì¹˜ì™€ ì§„í­ì„ ì‚¬ìš©í•´ í˜„ìž¬ ìŒì— í•´ë‹¹í•˜ëŠ” ë…¸íŠ¸ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
   * `noteInfos` ë°°ì—´ê³¼ ë¹„êµí•˜ì—¬ ê°€ìž¥ ê°€ê¹Œìš´ ê¸°ì¤€ ìŒì„ ì°¾ê³ , ì˜¥íƒ€ë¸Œë¥¼ ë³´ì •í•˜ì—¬ ê²°ê³¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.

4. **ì‹¤ì‹œê°„ ì‹œê°í™”**

   * ì„¸ ì¢…ë¥˜ì˜ ì˜¤ë””ì˜¤ ë¶„ì„ ë·°ë¥¼ í†µí•´ ì‹œê°ì ìœ¼ë¡œ ìƒíƒœë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

---

## ðŸ“Š `NodeRollingView`, `NodeOutputView`, `NodeFFTView` ì •ì˜ ë° ì°¨ì´ì 

| ë·°                 | ì •ì˜                 | ëª©ì                             | ì°¨ì´ì                     |
| ----------------- | ------------------ | ----------------------------- | ---------------------- |
| `NodeRollingView` | ì‹¤ì‹œê°„ íŒŒí˜• (ì˜¤ì‹¤ë¡œìŠ¤ì½”í”„ì²˜ëŸ¼)  | ì‹œê°„ì— ë”°ë¥¸ **íŒŒí˜• í˜•íƒœ** í™•ì¸           | ë‹¨ìˆœ ì˜¤ë””ì˜¤ ì‹ í˜¸ì˜ ì‹œê°„ ì¶• ë³€í™”     |
| `NodeOutputView`  | ì¶œë ¥ ë³¼ë¥¨/ë ˆë²¨ ë°” (meter) | **ì¶œë ¥ ì‹ í˜¸ì˜ ì„¸ê¸° (Amplitude)** ì‹œê°í™” | amplitude ê¸°ë°˜ì˜ ë‹¨ìˆœ ë ˆë²¨ í™•ì¸ |
| `NodeFFTView`     | ì£¼íŒŒìˆ˜ ë¶„ì„ (ìŠ¤íŽ™íŠ¸ëŸ¼)      | ì‹¤ì‹œê°„ **ì£¼íŒŒìˆ˜ ë¶„í¬(FFT)** ë¶„ì„        | ì†Œë¦¬ì— í¬í•¨ëœ ì£¼íŒŒìˆ˜ ì„±ë¶„ ì‹œê°í™”     |

ëª¨ë‘ `tappableNode`ì˜ ì„œë¡œ ë‹¤ë¥¸ ë…¸ë“œë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì—, ê°™ì€ ìž…ë ¥ì´ë”ë¼ë„ ê°ê¸° ë‹¤ë¥¸ ì‹œê° ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

---

## ðŸ“¦ ì •ë¦¬

* `TunerConductor`ëŠ” ì‹¤ì‹œê°„ ë§ˆì´í¬ ìž…ë ¥ì„ ë°›ì•„ ìŒì˜ ì£¼íŒŒìˆ˜ ë° ì§„í­ì„ ê³„ì‚°í•˜ê³ , ì´ë¥¼ ê¸°ì¤€ ìŒì— ë§¤ì¹­ì‹œì¼œ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
* ì˜¤ë””ì˜¤ ì‹ í˜¸ëŠ” Fader A â†’ B â†’ Cë¡œ íë¥´ë©°, ê°ê° ë³„ë„ì˜ ë·°ë¡œ ì‹œê°í™”ë©ë‹ˆë‹¤.
* ì‚¬ìš©ìž ìž…ìž¥ì—ì„œëŠ” **í˜„ìž¬ ìŒ ë†’ì´**, **ì„¸ê¸°**, **ìŠ¤íŽ™íŠ¸ëŸ¼**ì„ ë™ì‹œì— í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
* ì‹¤ì œ ì†Œë¦¬ëŠ” ì¶œë ¥ë˜ì§€ ì•Šì§€ë§Œ, ëª¨ë“  ì‹ í˜¸ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì˜¤ë””ì˜¤ ê·¸ëž˜í”„ë¥¼ í†µí•´ ì²˜ë¦¬ë˜ë¯€ë¡œ ì •ë°€í•œ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

# update(_:_:) ìƒì„¸ ì„¤ëª…

`update(_ pitch: AUValue, _ amp: AUValue)` í•¨ìˆ˜ëŠ” ì˜¤ë””ì˜¤ ìž…ë ¥(ë§ˆì´í¬ ë“±)ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°›ì€ **ì£¼íŒŒìˆ˜(pitch)** ì™€ **ì§„í­(amplitude)** ì„ ê¸°ë°˜ìœ¼ë¡œ ìŒì´ë¦„ê³¼ ì˜¥íƒ€ë¸Œ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ëŠ” ë¡œì§ìž…ë‹ˆë‹¤. ì•„ëž˜ì— **ë¼ì¸ë³„ë¡œ ìƒì„¸ ë¶„ì„**ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ðŸ”§ ì „ì²´ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜

```swift
func update(_ pitch: AUValue, _ amp: AUValue)
```

* ì‹¤ì‹œê°„ìœ¼ë¡œ **PitchTap** ì½œë°±ì—ì„œ ì „ë‹¬ëœ `pitch` (Hz ë‹¨ìœ„)ì™€ `amp` (ì§„í­)ë¥¼ ë°›ì•„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
* `AUValue`ëŠ” `Float`ì˜ typealiasìž…ë‹ˆë‹¤.

---

## 1. ì§„í­ì´ ë„ˆë¬´ ìž‘ìœ¼ë©´ ë¬´ì‹œ

```swift
guard amp > 0.1 else {
  return
}
```

* **ë°°ê²½ ìž¡ìŒì„ í•„í„°ë§**í•˜ê¸° ìœ„í•œ ì¡°ê±´ìž…ë‹ˆë‹¤.
* ì§„í­(amp)ì´ 0.1ë³´ë‹¤ ìž‘ìœ¼ë©´ ê±°ì˜ ë¬´ìŒ ë˜ëŠ” ë…¸ì´ì¦ˆë¡œ ê°„ì£¼í•˜ì—¬ ë¬´ì‹œí•©ë‹ˆë‹¤.
* â†’ **ë¶ˆí•„ìš”í•œ pitch ì¶”ì ì„ í”¼í•©ë‹ˆë‹¤.**

---

## 2. ë°ì´í„° ì €ìž¥

```swift
data.pitch = pitch
data.amplitude = amp
```

* ì™¸ë¶€ UIì—ì„œ ê´€ì°° ê°€ëŠ¥í•œ `@Published var data`ì— ê°’ì„ ì €ìž¥í•©ë‹ˆë‹¤.
* SwiftUI ë·°ì—ì„œ ì´ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

---

## 3. ì£¼íŒŒìˆ˜ë¥¼ 1ì˜¥íƒ€ë¸Œ ë²”ìœ„ë¡œ ì •ê·œí™”

```swift
var frequency = pitch
while frequency > Float(noteInfos[noteInfos.count - 1].frequency) {
  frequency /= 2.0
}
while frequency < Float(noteInfos[0].frequency) {
  frequency *= 2.0
}
```

* ìž…ë ¥ëœ pitch(ì˜ˆ: 440Hz)ê°€ 1ì˜¥íƒ€ë¸Œ(12ìŒê³„) ê¸°ì¤€ ì£¼íŒŒìˆ˜ ë²”ìœ„ë¥¼ ë²—ì–´ë‚  ìˆ˜ ìžˆìœ¼ë¯€ë¡œ,
* ê°€ìž¥ ê°€ê¹Œìš´ 1ì˜¥íƒ€ë¸Œ ë²”ìœ„(ì•½ 16.35\~30.87Hz)ë¡œ **ì •ê·œí™”**í•©ë‹ˆë‹¤.
* ì´ ê³¼ì •ì„ í†µí•´ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ **12ê°œì˜ ê¸°ì¤€ ìŒí‘œ(noteInfos)** ì™€ ë¹„êµí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

---

## 4. ê°€ìž¥ ê°€ê¹Œìš´ ìŒì„ ì°¾ê¸° ìœ„í•œ ì´ˆê¸°ê°’ ì„¤ì •

```swift
var minDistance: Float = 10000.0
var index = 0
```

* `minDistance`: ê°€ìž¥ ê°€ê¹Œìš´ ìŒí‘œì™€ì˜ ì£¼íŒŒìˆ˜ ì°¨ì´ë¥¼ ì €ìž¥í•  ë³€ìˆ˜
* `index`: ê°€ìž¥ ê°€ê¹Œìš´ ìŒì˜ `noteInfos` ì¸ë±ìŠ¤ë¥¼ ì €ìž¥í•©ë‹ˆë‹¤.

---

## 5. 12ê°œì˜ ê¸°ì¤€ ìŒ ì¤‘ ê°€ìž¥ ê°€ê¹Œìš´ ìŒ ì°¾ê¸°

```swift
for possibleIndex in noteInfos.indices {
  let distance = fabsf(Float(noteInfos[possibleIndex].frequency) - frequency)
  if distance < minDistance {
    index = possibleIndex
    minDistance = distance
  }
}
```

* `fabsf`: float ê°’ì˜ ì ˆëŒ“ê°’ì„ êµ¬í•¨.
* ê° noteì™€ `frequency` ê°„ ì°¨ì´ë¥¼ ê³„ì‚°í•˜ê³ , ê°€ìž¥ ìž‘ì€ ì°¨ì´ë¥¼ ê°€ì§„ indexë¥¼ ì €ìž¥í•©ë‹ˆë‹¤.
* ì¦‰, **ì–´ë–¤ ìŒ(C, Câ™¯ ë“±)** ì— ê°€ìž¥ ê°€ê¹Œìš´ì§€ ì°¾ëŠ” ë¡œì§ìž…ë‹ˆë‹¤.

---

## 6. ì˜¥íƒ€ë¸Œ ê³„ì‚°

```swift
let octave = Int(log2f(pitch / frequency))
```

* ì›ëž˜ì˜ pitchì™€ ìœ„ì—ì„œ ì •ê·œí™”ëœ frequencyì˜ **ë¹„ìœ¨ì„ log2f**ë¡œ ë³€í™˜í•´ ì˜¥íƒ€ë¸Œë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
* ì˜ˆ: `pitch = 440`, `frequency = 27.5` â†’ 440 / 27.5 = 16 â†’ log2(16) = 4 â†’ ì˜¥íƒ€ë¸Œ 4ì°¨ì´

---

## 7. ê²°ê³¼ ìŒí‘œ ì´ë¦„ ì €ìž¥

```swift
data.noteNameWithSharps = "\(noteInfos[index].noteNamesWithSharps)\(octave)"
data.noteNameWithFlats = "\(noteInfos[index].noteNamesWithFlats)\(octave)"
```

* ê°€ìž¥ ê°€ê¹Œìš´ ìŒí‘œë¥¼ **ìƒ¤í”„ ë˜ëŠ” í”Œëž«** ì´ë¦„ìœ¼ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤. ì˜ˆ: `Câ™¯4`, `Dâ™­4`
* ì´ ê°’ì€ í™”ë©´ì˜ í…ìŠ¤íŠ¸ ë·°ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë³´ìž…ë‹ˆë‹¤: `Câ™¯4 / Dâ™­4`

---

## âœ… ìš”ì•½

| ì—­í•       | ê¸°ëŠ¥                   |
| ------- | -------------------- |
| ì§„í­ í•„í„°ë§  | ìž¡ìŒì„ ì œì™¸               |
| ì£¼íŒŒìˆ˜ ì •ê·œí™” | 12ìŒê³„ ë²”ìœ„ë¡œ ë§¤í•‘          |
| ìŒí‘œ ì¶”ì    | ê°€ìž¥ ê°€ê¹Œìš´ ìŒí‘œ íƒìƒ‰         |
| ì˜¥íƒ€ë¸Œ ì¶”ì •  | ì£¼íŒŒìˆ˜ ì°¨ì´ ê¸°ë°˜ ê³„ì‚°         |
| ì¶œë ¥ ì €ìž¥   | UIì— í‘œì‹œí•  note name í• ë‹¹ |

ì´ í•¨ìˆ˜ëŠ” ê²°êµ­ ì‹¤ì‹œê°„ ìž…ë ¥ìœ¼ë¡œë¶€í„° **"í˜„ìž¬ ë“¤ë¦¬ëŠ” ìŒì€ ì–´ë–¤ ìŒì¸ì§€, ëª‡ ì˜¥íƒ€ë¸Œì¸ì§€"** ë¥¼ ê³„ì‚°í•´ì£¼ëŠ” í•µì‹¬ ë¡œì§ìž…ë‹ˆë‹¤.

