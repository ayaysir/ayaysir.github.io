---
title: AudioKitì˜ Waveform
author: ayaysir
date: 2025-06-20 20:10:19 +0900
categories: [StudyLog, AudioKit]
tags: [AudioKit, á„‹á…³á†·á„’á…£á†¼á„‹á…µá„…á…©á†«]
---

# Waveform

ì´ ì½”ë“œëŠ” SwiftUIì™€ AudioKit, WaveformKitì„ í™œìš©í•˜ì—¬ **ì˜¤ë””ì˜¤ íŒŒí˜•ì„ ì‹œê°í™”í•˜ê³ **, ì‚¬ìš©ìê°€ **ë“œë˜ê·¸ë¡œ ì¬ìƒ ë²”ìœ„(start \~ length)ë¥¼ ì§€ì •**í•  ìˆ˜ ìˆëŠ” ì¸í„°ë™í‹°ë¸Œí•œ Waveform í”Œë ˆì´ì–´ì…ë‹ˆë‹¤.
ê° êµ¬ì„±ìš”ì†Œì— ëŒ€í•´ **ì—­í• ê³¼ ë™ì‘ ë°©ì‹**ì„ ì¤‘ì‹¬ìœ¼ë¡œ ìì„¸íˆ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

---

# âœ… 1. `WaveformConductor`

```swift
class WaveformConductor: ObservableObject, ProcessesPlayerInput
```

### ğŸ”¹ ì—­í• 

* ì˜¤ë””ì˜¤ ì¬ìƒì„ ë‹´ë‹¹í•˜ëŠ” AudioKit ê¸°ë°˜ ì˜¤ë””ì˜¤ ì»¨íŠ¸ë¡¤ëŸ¬
* `AudioPlayer`, `SampleBuffer`ë¥¼ ì„¤ì •í•˜ê³  ì œê³µ
* UIì™€ ë°”ì¸ë”©ë  ìˆ˜ ìˆë„ë¡ `@Published`ë¥¼ í†µí•´ `samples` ê³µê°œ

### ğŸ”¹ ë‚´ë¶€ êµ¬ì„±

* `AudioEngine`ì„ í†µí•´ ì˜¤ë””ì˜¤ ì¬ìƒ í™˜ê²½ ì„¤ì •
* `player`ëŠ” `AudioPlayer`, `.buffer`ì— `Cookbook.sourceBuffer(source: .piano)` ë¥¼ ì„¤ì •í•´ `.piano` ìƒ˜í”Œì„ ì‚¬ìš©
* `player.isLooping = true` â†’ ì˜¤ë””ì˜¤ ë¬´í•œ ë°˜ë³µ
* `createSampleBuffer()`:

  * `AudioBuffer`ë¥¼ `Float` ë°°ì—´ë¡œ ë³€í™˜í•´ ì‹œê°í™”ë¥¼ ìœ„í•œ `SampleBuffer` ìƒì„±

---

# âœ… 2. `WaveformView`

```swift
struct WaveformView: View
```

### ğŸ”¹ ì—­í• 

* íŒŒí˜• ì‹œê°í™” ë° ë“œë˜ê·¸ UI í¬í•¨
* `start`ì™€ `length`ë¥¼ ì¡°ì ˆí•´ì„œ ì¬ìƒ ë²”ìœ„ ì§€ì •
* ì‹¤ì œ ì˜¤ë””ì˜¤ ì¬ìƒì€ `conductor`ë¥¼ í†µí•´ ìˆ˜í–‰ë¨

### ğŸ”¹ êµ¬ì„± ìƒíƒœ ë³€ìˆ˜

| ë³€ìˆ˜          | ì„¤ëª…                         |
| ----------- | -------------------------- |
| `conductor` | ì˜¤ë””ì˜¤ ì¬ìƒ ê´€ë¦¬                  |
| `start`     | ì„ íƒëœ êµ¬ê°„ì˜ ì‹œì‘ ìœ„ì¹˜ (0.0 \~ 1.0) |
| `length`    | ì„ íƒëœ êµ¬ê°„ì˜ ê¸¸ì´ (0.0 \~ 1.0)    |
| `formatter` | ìˆ«ì í‘œì‹œìš© í¬ë§·í„°                 |

---

### ğŸ”¸ ë‚´ë¶€ ë·° êµ¬ì„±

#### â‘  íŒŒë¼ë¯¸í„° í‘œì‹œ

```swift
Text("start: \(start), length: \(length), end: \(start + length)")
```

* í˜„ì¬ ì¬ìƒ ë²”ìœ„ (0.0 \~ 1.0 ë‹¨ìœ„) í‘œì‹œ

#### â‘¡ `PlayerControlsII`

```swift
PlayerControlsII(conductor: conductor, source: .piano) { conductor.createSampleBuffer() }
```

* AudioKit Cookbookì—ì„œ ì œê³µí•˜ëŠ” ì œì–´ìš© ì»¨íŠ¸ë¡¤ ë·°
* `.piano` ì†ŒìŠ¤ë¥¼ ì¬ìƒí•˜ë©°, ë¦¬ì…‹ ë²„íŠ¼ ëˆ„ë¥´ë©´ `createSampleBuffer()` í˜¸ì¶œ

#### â‘¢ Waveform íŒŒí˜• ì‹œê°í™” 1 (í° í™”ë©´)

```swift
ZStack {
  Waveform(samples: conductor.samples)
  MinimapView(start: $start, length: $length)
}
```

* íŒŒí˜• ìœ„ì— íˆ¬ëª…í•œ ì‚¬ê°í˜•(`MinimapView`)ì„ ë®ì–´ ë“œë˜ê·¸ ì˜ì—­ ì§€ì • ê°€ëŠ¥

#### â‘£ Waveform íŒŒí˜• ì‹œê°í™” 2 (ì„ íƒ ì˜ì—­ë§Œ ê°•ì¡°)

```swift
Waveform(
  samples: conductor.samples,
  start: Int(start * sampleRangeLength),
  length: Int(length * sampleRangeLength)
)
```

* ìœ„ì—ì„œ ì„ íƒëœ `start` \~ `length` ë²”ìœ„ë§Œ ê°•ì¡°í•´ì„œ ë³´ì—¬ì¤Œ

#### â‘¤ ë¼ì´í”„ì‚¬ì´í´

```swift
.onAppear(perform: conductor.start)
.onDisappear(perform: conductor.stop)
```

* ë·°ê°€ ë“±ì¥í•˜ë©´ ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œì‘, ì‚¬ë¼ì§€ë©´ ì •ì§€

---

# âœ… 3. `MinimapView`

### ğŸ”¹ ì—­í• 

* ì‚¬ìš©ìê°€ **ë“œë˜ê·¸ë¡œ ì¬ìƒ ë²”ìœ„ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë„ë¡** í•˜ëŠ” ë·°
* ë‘ ê°œì˜ `RoundedRectangle`ì´ ìˆê³ :

  * í•˜ë‚˜ëŠ” **ì„ íƒëœ ì˜ì—­**
  * í•˜ë‚˜ëŠ” **ìš°ì¸¡ ê²½ê³„ ì¡°ì ˆ í•¸ë“¤**

---

### ğŸ”¸ ì£¼ìš” ìƒíƒœ

| ë³€ìˆ˜                    | ì„¤ëª…                         |
| --------------------- | -------------------------- |
| `@Binding var start`  | ì‹œì‘ ìœ„ì¹˜ (WaveformViewì—ì„œ ë°”ì¸ë”©) |
| `@Binding var length` | ê¸¸ì´                         |
| `@GestureState`       | ë“œë˜ê·¸ ì‹œì‘ ì‹œ ê¸°ì¤€ê°’ ì €ì¥ìš© ìƒíƒœ ë³€ìˆ˜     |

---

### ğŸ”¸ ë‚´ë¶€ êµ¬ì„±

```swift
GeometryReader { geometry in
  RoundedRectangle(...)    // ì„ íƒ ì˜ì—­
  RoundedRectangle(...)    // ìš°ì¸¡ ì¡°ì ˆ í•¸ë“¤
}
```

#### ë“œë˜ê·¸ ë™ì‘ ì²˜ë¦¬

ê° ì‚¬ê°í˜•ì— `.gesture(dragGesture(...))`ë¥¼ ì¶”ê°€í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ì²˜ë¦¬í•©ë‹ˆë‹¤:

```swift
func dragGesture(of mode: DragMode, geometryProxy geometry: GeometryProxy) -> some Gesture
```

| DragMode        | ë™ì‘                        |
| --------------- | ------------------------- |
| `.selectedArea` | ì‚¬ê°í˜• ì „ì²´ë¥¼ ì¢Œìš°ë¡œ ì´ë™ (start ë³€ê²½) |
| `.handle`       | ìš°ì¸¡ë§Œ ë“œë˜ê·¸ â†’ length ì¡°ì ˆ       |

ë“œë˜ê·¸ ë¹„ìœ¨ ê³„ì‚°:

```swift
drag.translation.width / geometry.size.width
```

`clamped(to:)`ë¡œ `start + length â‰¤ 1.0` ì œì•½ ìœ ì§€

---

## ğŸ” ì‹¤ì œ íŒŒí˜• ì¬ìƒ ì œì–´ëŠ”?

í˜„ì¬ `WaveformView`ì—ì„œ `.onAppear(perform: conductor.start)`ë¡œ ì „ì²´ ì˜¤ë””ì˜¤ê°€ ë£¨í”„ ì¬ìƒë˜ë©°,
ì„ íƒëœ êµ¬ê°„ë§Œ **ì¬ìƒí•˜ë„ë¡ í™•ì¥í•˜ë ¤ë©´** `player.play(from:to:)` ë©”ì„œë“œë¡œ `start`ì™€ `length` ê¸°ë°˜ êµ¬ê°„ ì¬ìƒì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤ (ì´ì „ ë‹µë³€ ì°¸ê³ ).

---

## âœ… ì „ì²´ íë¦„ ìš”ì•½

```
AudioPlayer.loadBuffer(.piano)
        â†“
SampleBuffer ìƒì„± â†’ WaveformViewì— ì—°ê²°
        â†“
Waveform ì‹œê°í™” + ë“œë˜ê·¸ ì œìŠ¤ì²˜ë¡œ start/length ì¡°ì ˆ
        â†“
í•˜ë‹¨ì— ì„ íƒëœ ì˜ì—­ Waveform ê°•ì¡° í‘œì‹œ
        â†“
(.onAppear ì‹œ ì „ì²´ ë£¨í”„ ì¬ìƒ)
```

---
