# Variable Delay Operaion

μ΄ μ½”λ“λ” `AudioKit`μ„ κΈ°λ°μΌλ΅ ν• **κ°€λ³€ λ”λ μ΄ ν¨κ³Ό(variable delay effect)** λ¥Ό κµ¬ν„ν•λ” κµ¬μ΅°μ…λ‹λ‹¤. μ…λ ¥λ μ¤λ””μ¤μ— **μ§€μ†μ μΌλ΅ λ³€ν•λ” μ‹κ°„ λ° ν”Όλ“λ°±**μ„ μ μ©ν•μ—¬, κ³µκ°„κ° μκ³  μ κΈ°μ μΈ μ‚¬μ΄λ“λ¥Ό λ§λ“¤μ–΄λƒ…λ‹λ‹¤. μ•„λμ—μ„ μ „μ²΄ κµ¬μ΅°, λ³€μ μ—­ν• , κ° μμΉκ°€ μλ―Έν•λ” λ°”λ¥Ό μƒμ„Έν μ„¤λ…λ“λ¦¬κ² μµλ‹λ‹¤.

---

## π§± μ „μ²΄ κµ¬μ΅° μ”μ•½

```swift
class VariableDelayOperationConductor: ObservableObject, ProcessesPlayerInput
```

* `ObservableObject`: SwiftUIμ—μ„ μƒνƒλ¥Ό κ΄€μ°°ν•μ—¬ UIλ¥Ό κ°±μ‹  κ°€λ¥
* `ProcessesPlayerInput`: μ‚¬μ΄λ“ μ†μ¤λ¥Ό λ¶λ¬μ¤κ³  μ¬μƒν•λ” μ—­ν• 
* ν•µμ‹¬ μ”μ†: **`AudioPlayer`, `OperationEffect`, `DryWetMixer`**

---

## π” μ¤λ””μ¤ μ²΄μΈ κµ¬μ΅°

```text
AudioPlayer ("Piano" μƒν”)
       β†“
OperationEffect (VariableDelay)
       β†“
DryWetMixer (dry / wet λ―Ήμ¤)
       β†“
AudioEngine.output
```

---

## π› μ£Όμ” λ³€μ μ„¤λ…

### `VariableDelayOperationData`

μ΄ κµ¬μ΅°μ²΄λ” μ¬λΌμ΄λ” UI λ“±μ—μ„ μ΅°μ • κ°€λ¥ν• νλΌλ―Έν„°λ“¤μ„ μ €μ¥ν•©λ‹λ‹¤.

| λ³€μλ…                 | μ„¤λ…                                | λ‹¨μ„    | κΈ°λ³Έκ°’    |
| ------------------- | --------------------------------- | ----- | ------ |
| `maxTime`           | **μµλ€ μ§€μ—° μ‹κ°„**, μ‹κ°„ νν•μ΄ μ΄ κ°’ μ΄ν•μ—μ„ λ³€λ™  | μ΄ (s) | `0.2`  |
| `frequency`         | **λ”λ μ΄ μ‹κ°„ λ³€μ΅°μ— μ‚¬μ©λλ” μ‚¬μΈνμ μ£Όνμ**      | Hz    | `0.3`  |
| `feedbackFrequency` | **ν”Όλ“λ°± μ–‘μ„ λ³€μ΅°ν•λ” μ‚¬μΈν μ£Όνμ**           | Hz    | `0.21` |
| `rampDuration`      | νλΌλ―Έν„° κ°’ λ³€κ²½ μ‹ μ μ§„μ μΌλ΅ μ μ©λ  μ‹κ°„          | μ΄ (s) | `0.1`  |
| `balance`           | dry/wet λ―Ήμ¤ λΉ„μ¨ (0 = μ›μλ§, 1 = μ΄ν™νΈλ§) | 0\~1  | `0.5`  |

---

## π `OperationEffect` λ‚΄ μ‹¤μ  μ²λ¦¬

```swift
let time = Operation.sineWave(frequency: params.n(2))
  .scale(minimum: 0.001, maximum: params.n(1))
```

* `params.n(1)` = `maxTime`
* `params.n(2)` = `frequency`

β†’ μ΄ κµ¬λ¬Έμ€ **μ‚¬μΈν ν•νƒλ΅ μ£ΌκΈ°μ μΌλ΅ λ³€ν•λ” λ”λ μ΄ μ‹κ°„(time)** μ„ λ§λ“­λ‹λ‹¤.

* μ) `maxTime = 0.2`, `frequency = 0.3Hz` β†’ 3.3μ΄μ— ν• λ² μ£ΌκΈ°κ°€ λ„λ” μ§€μ—°μ‹κ°„ νν•

```swift
let feedback = Operation.sineWave(frequency: params.n(3))
  .scale(minimum: 0.5, maximum: 0.9)
```

* `params.n(3)` = `feedbackFrequency`

β†’ ν”Όλ“λ°± μ—­μ‹ μ‚¬μΈνλ΅ μ§„λ™ν•λ©° λ³€ν™” (μ”ν–¥ κΈΈμ΄κ°€ κ³„μ† λ³€ν•¨)

```swift
return player.variableDelay(
  time: time,
  feedback: feedback,
  maximumDelayTime: 1.0
)
```

* **μ‹¤μ  μ μ©**λλ” λ”λ μ΄ ν•¨μ.
* `maximumDelayTime`μ€ μ‹μ¤ν…μ΄ λ²„νΌλ¥Ό μ–Όλ§λ‚ μ΅μ„μ§€ κ²°μ •ν•λ” μƒν•κ°’ (μ•μ „μƒ 1.0μ΄ μ„¤μ •)

---

## π” `DryWetMixer`

```swift
dryWetMixer = DryWetMixer(player, delay)
```

* μ›λ³Έ μ†λ¦¬ (`dry`)μ™€ μ΄ν™νΈκ°€ μ μ©λ μ†λ¦¬ (`wet`)λ¥Ό μ„λ” λ―Ήμ„
* `balance` κ°’μ„ ν†µν•΄ λΉ„μ¤‘ μ΅°μ  κ°€λ¥ (`0.5`λ©΄ λ°λ°)

---

## π”„ μ‹¤μ‹κ°„ νλΌλ―Έν„° λ°μ

```swift
delay.$parameter1.ramp(to: data.maxTime, duration: data.rampDuration)
```

* `.ramp(to:, duration:)`λ” μ§€μ •ν• κ°’μΌλ΅ **λ¶€λ“λ½κ² μ²μ²ν λ³€ν™”**
* ν΄λ¦­μ΄λ‚ μ¬λΌμ΄λ” μ΅°μ‘ μ‹ **λλ λκΈ°μ§€ μ•κ³  μμ—°μ¤λ½κ²** λ³€ν™”

---

## π“ κ²°κ³Όμ μΌλ΅ λ§λ“¤μ–΄μ§€λ” μ‚¬μ΄λ“ νΉμ§•

* λ”λ μ΄ μ‹κ°„κ³Ό ν”Όλ“λ°± μ–‘μ΄ **κ³„μ† μ§„λ™**ν•λ―€λ΅, μ†λ¦¬κ°€ ν”λ“¤λ¦¬λ“― λ°μ‚¬λκ³  μ”ν–¥λ„ κΈΈμ΄κ°€ κ³„μ† λ³€ν•¨
* **μ κΈ°μ μΈ κ³µκ°„κ°**, λ¦¬λ“λ―Έμ»¬ν• λ°°κ²½μμ— μ ν•©
* μ¬μ¦, μ•°λΉ„μ–ΈνΈ, μ „μμμ•…μ—μ„ ν”ν μ‚¬μ©λλ” ν•νƒ

---

## β… μ”μ•½

| μ”μ†             | μ„¤λ…                                     |
| -------------- | -------------------------------------- |
| `time`         | μ‚¬μΈνλ΅ μ§„λ™ν•λ” λ”λ μ΄ μ‹κ°„ (0.001μ΄ \~ `maxTime`) |
| `feedback`     | μ‚¬μΈνλ΅ μ§„λ™ν•λ” ν”Όλ“λ°± λΉ„μ¨ (0.5 \~ 0.9)          |
| `frequency`    | μ„ μ‚¬μΈνλ“¤μ μ§„λ™ μ†λ„ μ„¤μ •                       |
| `rampDuration` | νλΌλ―Έν„° λ³€κ²½ μ‹ λ”±λ”± λκΈ°μ§€ μ•κ³  λ¶€λ“λ½κ² μ μ©            |
| `balance`      | dry/wet μμ„ μ„λ” λΉ„μ¨                       |
| μ „μ²΄ ν¨κ³Ό          | κ³µκ°„μ΄ κ³„μ† λ³€ν™”ν•λ” λ“―ν• λ¨λ“λ μ΄μ… λ”λ μ΄ ν¨κ³Ό            |

---


