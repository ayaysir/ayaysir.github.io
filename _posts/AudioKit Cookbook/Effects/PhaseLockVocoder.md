# Phase Lock Vocoder

이 코드는 **AudioKit** 프레임워크를 사용해 **Phase Locked Vocoder**를 제어하고 시각화하는 macOS 또는 iOS용 SwiftUI 앱입니다. 주 목적은 **사전 녹음된 오디오 파일**을 불러와 **PhaseLockedVocoder 효과**를 적용하고, 사용자 입력에 따라 음성을 조작할 수 있도록 하는 **오디오 이펙트 체험 도구**입니다.

---

## 🧠 프로그램 개요

이 앱은 다음과 같은 역할을 합니다:

| 기능               | 설명                                             |
| ---------------- | ---------------------------------------------- |
| 🎧 오디오 파일 선택     | 드럼, 피아노 등 다양한 오디오 소스를 선택할 수 있음 (`Picker`)      |
| 🌀 Vocoder 효과 적용 | `PhaseLockedVocoder`를 통해 입력 오디오에 특수한 변조 효과를 적용 |
| 🎛️ 실시간 조작       | `Ribbon` UI를 통해 `position` 파라미터를 사용자가 조작 가능    |
| 🔊 오디오 출력        | `NodeOutputView`로 출력 시각화                       |

---

## 🔩 주요 구성 요소 설명

### `PhaseLockedVocoderConductor`

* `ObservableObject`를 채택해 SwiftUI 뷰와 바인딩됨.
* **AudioKit의 `AudioEngine`**, **`AudioPlayer`**, \*\*`PhaseLockedVocoder`\*\*를 초기화하고 연결함.
* `@Published`:

  * `source`: 오디오 소스 변경 시 자동으로 `setup()` 호출하여 효과 적용.
  * `position`: 사용자 인터페이스에서 리본 조작 시 Vocoder의 `position` 파라미터를 실시간으로 업데이트.

#### `setup(source:)`

* `.drums` 같은 `GlobalSource` 열거형을 기반으로 번들에서 오디오 파일을 불러옴.
* `PhaseLockedVocoder(file:)`로 vocoder를 생성하고 AudioEngine 출력에 연결.

---

### `PhaseLockedVocoderView`

* SwiftUI 뷰로 사용자 인터페이스를 구성.
* `@StateObject`로 conductor를 보유하고 있어 상태 변화를 감지.
* 주요 UI:

  * `Picker`: 소스 선택
  * `Text`: 현재 position 표시
  * `Ribbon`: position 값을 조절
  * `NodeOutputView`: 오디오 출력 시각화

---

## 🎙️ PhaseLockedVocoder란?

`PhaseLockedVocoder`는 일반적인 Vocoder와 달리 **신호의 위상과 주파수를 동기화**하여 더 **자연스럽고 명료한 음성 변조**를 생성하는 AudioKit의 DSP 이펙트입니다.

* 원리: 입력 신호의 주파수 성분을 분해한 후, 위상을 고정(fix)한 채 다시 조합하여 새로운 합성된 소리를 생성. 음색은 변형되지만 명료도를 유지함.
* 효과: 일반 보코더보다 자연스럽고 음정 변화 시 위상 깨짐이 덜함. 로봇 보이스, 특수 보컬 효과 등에 적합함.

### Vocoder?

Vocoder(Voice Encoder)는 원래는 음성 압축 기술이었지만, 음악에서는 한 소리(주로 음성)의 특징을 다른 소리(주로 신디사이저 등)에 입혀서 새로운 소리로 만드는 효과를 말합니다.
예: 로봇 목소리, "Daft Punk"나 "Zedd" 등에서 들리는 음성 변조 효과.

### 파라미터 목록

`pitchRatio`와 `amplitude`는 `PhaseLockedVocoder`에서 **소리의 성질을 제어하는 중요한 파라미터**입니다. 아래에 각각의 의미와 효과를 설명드리겠습니다.

---

### `position`: 분석된 주파수 영역 중 어느 위치를 참조할지 

(보통 0.0 ~ 1.0 범위).

### 🎚 `pitchRatio`: 피치 비율 조절

* **정의**: 원본 오디오의 주파수를 몇 배로 늘릴지를 지정합니다.
* **값의 범위 예시**:

  * `1.0` → 원래 음정
  * `2.0` → 1옥타브 위
  * `0.5` → 1옥타브 아래
  * `1.5` → 완전 5도 위

#### 🎧 효과

* `pitchRatio = 1.0`: 원본의 음정 그대로 재생
* `> 1.0`: 음정이 높아지고, 마치 헬륨가스를 마신 듯한 보컬 느낌
* `< 1.0`: 음정이 낮아지고, 저음의 느린 목소리처럼 들림

> 💡 **보코더 효과의 핵심 조절 요소**입니다. 음성을 키우거나 낮추어 특수한 음성 변형을 만듭니다.


### 📢 `amplitude`: 출력 음량 조절

* **정의**: vocoder가 출력하는 사운드의 **볼륨 레벨**을 조절합니다.
* **일반 범위**: `0.0 ~ 1.0`

#### 🎧 효과

* `0.0`: 출력 없음 (음소거)
* `0.5`: 절반 정도의 음량
* `1.0`: 원래의 전체 볼륨

> 이 파라미터는 음색을 바꾸는 것이 아니라 **최종 볼륨 크기를 조절**할 때 사용됩니다.


### 🧪 함께 사용할 때

* `pitchRatio`는 **음색과 분위기**를 바꾸고,
* `amplitude`는 \*\*소리의 강도(볼륨)\*\*를 조절합니다.

예를 들어 `pitchRatio = 0.7`, `amplitude = 0.5`로 설정하면
→ "낮은 피치의 부드러운 로봇 보컬" 같은 느낌이 납니다.


---

## 🧪 사용 예시

* 음악 앱에서 보컬 트랙을 가공하거나
* 오디오 실험 앱에서 음성 조작 실습 도구로 사용
* 실시간 사운드 퍼포먼스에 Vocoder 효과 삽입
* 🎶 신디사이징 및 리샘플링 도구로도 사용 가능

---

## 🎯 왜 `position`으로 특정 음이 지속되나?

`PhaseLockedVocoder`는 FFT(고속 푸리에 변환) 기반 분석을 통해 **소리를 주파수 스펙트럼으로 분해**합니다.
그 스펙트럼 중 **한 지점을 `position`으로 고정**하면, 해당 대역에 존재하던 에너지(=음색)를 계속 유지하며 **해당 음의 성분만 출력**하는 형태가 됩니다.

예시:

* `position = 0.3`: 원본 소리의 30% 지점(주로 특정 음역)의 주파수 성분만 출력
* `position = 0.8`: 더 높은 음역대의 특정 주파수 성분만 출력됨

---

## 🧩 이걸 어디에 쓰나?

이건 단순히 음을 재생하는 게 아니라, **음성 또는 소리의 특정 특성(음색, 공명점 등)을 고정하고 그걸 악기처럼 연주**하는 데 사용됩니다.

### 예시 활용:

1. **특정 음색 추출**
   보컬에서 `아`, `에`, `이`처럼 들리는 부분을 고정해놓고 필터처럼 사용

2. **실시간 조작**
   `position`을 슬라이더나 리본 UI로 연속 조작하면 음색이 흐르듯 변화 — 보코더 필터처럼 사용 가능

3. **사운드 디자인**
   화성적 움직임 없이도 음색 기반으로 분위기 구성 가능 (예: 앰비언트 음악, 효과음 등)

---

## 🛠 요약

| 동작                | 설명                         |
| ----------------- | -------------------------- |
| `position`을 고정    | 특정 음역의 스펙트럼만 유지되어 해당 음만 지속 |
| 슬라이더로 position 이동 | 음역/음색이 연속적으로 바뀌는 효과 발생     |
| 응용                | 음성 음색을 기반으로 하는 신디사이저처럼 사용  |

즉, `PhaseLockedVocoder`는 단순한 이펙터라기보다 **소리의 주파수 특성을 악기처럼 쓰는 음향 도구**라고 이해하시면 됩니다.

---

## ✅ **실전 사용 방식**

1. **`position`을 고정**

   * 원본 오디오의 스펙트럼 중 특정 위치(음색)를 선택합니다.
   * 예: 보컬 샘플의 ‘아’ 소리가 나는 부분에 해당하는 포지션 `0.3` 정도

2. **`pitchRatio`를 조절**

   * 고정된 스펙트럼(음색)을 더 높거나 낮은 음으로 **피치 변환**해서 재생합니다.
   * 즉, **한 음색으로 다양한 음을 연주**할 수 있게 됩니다.

3. (선택) `amplitude`를 조절

   * 출력 음량(진폭)을 조절하며, 대부분 0.0\~1.0 사이로 설정합니다.

---

## 🎵 예제 설명

예를 들어 보컬 샘플을 사용한다고 가정할 때:

| 설정                 | 의미                  |
| ------------------ | ------------------- |
| `position = 0.25`  | ‘E’ 발음처럼 들리는 부분을 고정 |
| `pitchRatio = 1.0` | 원래의 피치로 출력          |
| `pitchRatio = 2.0` | 한 옥타브 위에서 출력        |
| `pitchRatio = 0.5` | 한 옥타브 아래에서 출력       |
| `position = 0.8`   | ‘O’ 소리처럼 무거운 톤으로 전환 |

---

## 📌 요약

| 파라미터         | 역할                        |
| ------------ | ------------------------- |
| `position`   | 음색의 고정 지점 (정적인 주파수 성분 선택) |
| `pitchRatio` | 해당 음색의 높낮이 조절 (실제 피치 변경)  |
| `amplitude`  | 출력 음량 조절                  |

이 구조를 활용하면, **한 가지 소리(보컬, 신스 등)를 입력으로 다양한 음을 만드는 보코더 신디사이저**처럼 사용할 수 있습니다.

