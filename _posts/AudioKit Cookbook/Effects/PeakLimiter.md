# Peak Limiter

### 🎚️ 피크 리미터(Peak Limiter)란?

**피크 리미터**는 오디오 신호의 최대 진폭(peak amplitude)을 **강제로 제한(clamp)** 하여 **지정된 레벨 이상으로 신호가 넘어가지 않도록** 막는 효과입니다.
보통 다음과 같은 상황에 사용됩니다:

* 🔊 **클리핑 방지**: 신호가 너무 커서 디지털 클리핑이 발생하는 것을 막기 위해
* 🎤 **라이브 입력**: 마이크나 악기처럼 예상할 수 없는 큰 소리가 들어올 때
* 📼 **마스터링**: 오디오 트랙의 피크를 일정 수준으로 제한해 과도한 출력 방지

---

## 🔧 주요 파라미터 설명

```swift
Attack Time | 0.012 | 0.0005...0.03
Decay Time  | 0.024 | 0.001...0.04
Pre Gain    | 0.0   | -40.0...40.0
```

### 1. 🕒 `Attack Time`

* **의미**: 입력 신호가 임계값을 초과했을 때 **리미팅을 시작하는 데 걸리는 시간 (초)**
* **짧을수록**: 빠르게 반응해 순간적인 피크도 잘 잘라냅니다.
* **길수록**: 부드럽게 반응하지만, 빠른 트랜지언트(예: 킥 드럼)는 놓칠 수 있습니다.

| 값        | 효과 설명           |
| -------- | --------------- |
| `0.0005` | 극단적으로 빠르게 반응    |
| `0.012`  | 일반적인 설정 (기본값)   |
| `0.03`   | 느리게 반응, 더 자연스러움 |

---

### 2. 🕓 `Decay Time`

* **의미**: 피크 리미터가 동작한 후 **원래 상태로 회복되는 시간 (초)**
* **짧을수록**: 리미팅이 빠르게 해제됨 → 소리가 튀듯 들릴 수 있음
* **길수록**: 더 부드럽고 자연스럽게 해제됨 → 지속적인 리미팅 효과

| 값       | 효과 설명          |
| ------- | -------------- |
| `0.001` | 빠르게 원상 복구됨     |
| `0.024` | 일반적인 설정 (기본값)  |
| `0.04`  | 자연스럽고 부드럽게 복원됨 |

---

### 3. 🔊 `Pre Gain`

* **의미**: **리미터 전에** 신호를 증폭 or 감쇠
* **용도**:

  * 음량이 작은 소스를 리미터 수준까지 끌어올릴 때
  * 리미팅 테스트를 위해 신호를 강제로 클리핑 수준까지 올릴 때
* **양수 값**: 리미터가 더 자주, 더 강하게 작동함
* **음수 값**: 신호가 약해져 리미터가 잘 작동하지 않음

| 값       | 효과                |
| ------- | ----------------- |
| `-40.0` | 거의 리미팅 작동 안 함     |
| `0.0`   | 원래 볼륨             |
| `+10.0` | 피크 리미팅 자주 발생      |
| `+40.0` | 매우 자주 리미팅 발생 (강제) |

---

## 📈 시각적 예시

```
원래 신호:      ────────▇▇▇▇▇──────────────

리미터 적용 후: ────────█████──────────────  ← 일정 레벨 이상 깎임
```

---

## 참고: 리미터와 컴프레서의 차이

일반적으로 **PeakLimiter**는 "어느 볼륨부터 리미트를 걸지"에 대한 **명시적인 임계값(threshold) 설정이 없습니다**. 대신, **내부적으로 고정된 threshold** 값을 기준으로 동작합니다. 즉:

* **PeakLimiter**는 사용자가 threshold(임계값)를 직접 설정하지 않아도,
* **내부에서 적절한 임계값**(예: -0.1dBFS, -0.3dBFS 등)을 기준으로 판단하여,
* **그 이상으로 올라가는 피크**에 자동으로 리미트(limiting)를 적용합니다.

### 📌 리미터 vs 컴프레서 비교

| 구분            | PeakLimiter             | Compressor               |
| ------------- | ----------------------- | ------------------------ |
| **Threshold** | 사용자가 **설정 못함** (내장값 사용) | 사용자가 **직접 설정함**          |
| **Ratio**     | 매우 높음 (∞:1)             | 다양하게 설정 가능 (예: 2:1, 4:1) |
| **용도**        | 피크 급락 방지, 클리핑 방지        | 음량 균형 조절, 다이내믹 톤 연출      |
| **적용 시점**     | **마스터링**, 라이브 입력 안정화    | 개별 트랙 조정, 믹싱 단계 등        |


### 💡 내부 임계값이란?

AudioKit의 `PeakLimiter`는 Apple의 `AVAudioUnitPeakLimiter`를 감쌌으며, 해당 Apple 문서에서는 threshold 설정이 없고 다음처럼 설명됩니다:

> “This effect prevents clipping by automatically limiting the amplitude of audio that exceeds a certain internal threshold. (이 효과는 특정 내부 임계값을 초과하는 오디오의 진폭을 자동으로 제한하여 클리핑을 방지합니다.)”

즉, **사용자가 직접 어느 볼륨부터 자를지는 못 정하고**, 리미터가 자동으로 판단해 적용하는 구조입니다.

---

## ✅ 정리

| 요소          | 설명                        |
| ----------- | ------------------------- |
| PeakLimiter | 최대 신호 진폭을 제한하여 클리핑 방지     |
| Attack Time | 리미터가 **작동을 시작하는** 속도      |
| Decay Time  | 리미터가 **원상복귀하는** 속도        |
| Pre Gain    | 리미터 전에 신호 증폭/감쇠           |
| 활용 상황       | 라이브 입력, 마스터링, 과도한 피크 방지 등 |

이 리미터는 특히 예상할 수 없는 입력의 최대 음량을 안전하게 제한할 때 유용합니다.
