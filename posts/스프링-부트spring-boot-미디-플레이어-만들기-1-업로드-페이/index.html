<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="ko" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="스프링 부트(Spring Boot) 미디 플레이어 만들기 (2): 업로드 페이지, 임시 재생 플레이어 만들기" />
<meta property="og:locale" content="ko" />
<meta name="description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." />
<meta property="og:description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." />
<link rel="canonical" href="https://ayaysir.github.io/posts/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8spring-boot-%EB%AF%B8%EB%94%94-%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4-%EB%A7%8C%EB%93%A4%EA%B8%B0-1-%EC%97%85%EB%A1%9C%EB%93%9C-%ED%8E%98%EC%9D%B4/" />
<meta property="og:url" content="https://ayaysir.github.io/posts/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8spring-boot-%EB%AF%B8%EB%94%94-%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4-%EB%A7%8C%EB%93%A4%EA%B8%B0-1-%EC%97%85%EB%A1%9C%EB%93%9C-%ED%8E%98%EC%9D%B4/" />
<meta property="og:site_name" content="BGSMM" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-15T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="스프링 부트(Spring Boot) 미디 플레이어 만들기 (2): 업로드 페이지, 임시 재생 플레이어 만들기" />
<meta name="google-site-verification" content="pvY2wZTkfhJgJGUCvK9k0h-YX3Be3V-u1J4pE6FriWA" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-08-15T00:00:00+09:00","datePublished":"2020-08-15T00:00:00+09:00","description":"A minimal, responsive and feature-rich Jekyll theme for technical writing.","headline":"스프링 부트(Spring Boot) 미디 플레이어 만들기 (2): 업로드 페이지, 임시 재생 플레이어 만들기","mainEntityOfPage":{"@type":"WebPage","@id":"https://ayaysir.github.io/posts/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8spring-boot-%EB%AF%B8%EB%94%94-%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4-%EB%A7%8C%EB%93%A4%EA%B8%B0-1-%EC%97%85%EB%A1%9C%EB%93%9C-%ED%8E%98%EC%9D%B4/"},"url":"https://ayaysir.github.io/posts/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8spring-boot-%EB%AF%B8%EB%94%94-%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4-%EB%A7%8C%EB%93%A4%EA%B8%B0-1-%EC%97%85%EB%A1%9C%EB%93%9C-%ED%8E%98%EC%9D%B4/"}</script>
<!-- End Jekyll SEO tag -->


  <title>스프링 부트(Spring Boot) 미디 플레이어 만들기 (2): 업로드 페이지, 임시 재생 플레이어 만들기 | BGSMM
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="BGSMM">
<meta name="application-name" content="BGSMM">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>

  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/./assets/img/favicons/mstile-150x150.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">BGSMM</a>
    <p class="site-subtitle fst-italic mb-0">음악, 레트로테크 좋아함</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    

      
        <a
          href="https://github.com/ayaysir"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="javascript:location.href = 'mailto:' + ['yoonbumtae','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
          
        

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>스프링 부트(Spring Boot) 미디 플레이어 만들기 (2): 업로드 페이지, 임시 재생 플레이어 만들기</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>스프링 부트(Spring Boot) 미디 플레이어 만들기 (2): 업로드 페이지, 임시 재생 플레이어 만들기</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1597417200"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Aug 15, 2020
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://github.com/ayaysir">ayaysir</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="4378 words"
>
  <em>24 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">스프링 부트(Spring Boot) 미디 플레이어 만들기 (2): 업로드 페이지, 임시 재생 플레이어 만들기</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">스프링 부트(Spring Boot) 미디 플레이어 만들기 (2): 업로드 페이지, 임시 재생 플레이어 만들기</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <!-- \[rcblock id="2655"\] -->

<p>이전 글: <a href="/posts/스프링-부트spring-boot-미디-플레이어-만들기-1-timidity-lame을-이용해/">스프링 부트(Spring Boot) 미디 플레이어 만들기 (1): Timidity++, LAME을 이용해 미디(midi) 파일을 mp3로 변환하는 메소드 만들기</a></p>

<p> </p>

<h2 id="미디-플레이어-보기"><span class="me-2"><strong>미디 플레이어 보기</strong></span><a href="#미디-플레이어-보기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>이 서비스는 AWS 프리티어 기간 만료로 인해 폐쇄하였습니다.서비스 당시 모습을 영상 기록으로 확인할 수 있습니다.</p>

<style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style>
<div class="embed-container">    <iframe title="YouTube video player" width="640" height="390" src="//www.youtube.com/embed/ZqUtpc7yEYQ" frameborder="0" allowfullscreen=""></iframe></div>

<p> </p>

<h2 id="현재-버전에서의-timidityrunner"><span class="me-2"><strong>현재 버전에서의 TimidityRunner</strong></span><a href="#현재-버전에서의-timidityrunner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.example.awsboard.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.NoSuchAlgorithmException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimidityRunner</span> <span class="o">{</span>
    <span class="c1">// 여기로 보낼 때 루트 패스 포함해서 보냄.</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Boolean</span> <span class="nf">convertMidiToMp3</span><span class="o">(</span><span class="nc">String</span> <span class="n">midiPath</span><span class="o">,</span> <span class="nc">String</span> <span class="n">mp3Path</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>

        <span class="nc">Integer</span> <span class="n">lastIndexOfDot</span> <span class="o">=</span> <span class="n">mp3Path</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="s">"."</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">wavPath</span> <span class="o">=</span> <span class="n">mp3Path</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">lastIndexOfDot</span><span class="o">)</span> <span class="o">+</span> <span class="s">".wav"</span><span class="o">;</span>
<span class="c1">//        String mp3Path = midiPath.substring(0, lastIndexOfDot) + ".mp3";</span>

        <span class="nc">String</span><span class="o">[]</span> <span class="n">midiCmd</span> <span class="o">=</span> <span class="o">{</span><span class="s">"/usr/local/bin/timidity"</span><span class="o">,</span> <span class="n">midiPath</span><span class="o">,</span> <span class="s">"-o"</span><span class="o">,</span> <span class="n">wavPath</span><span class="o">,</span> <span class="s">"-Ow"</span><span class="o">};</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"** run &gt;&gt;&gt;&gt; "</span> <span class="o">+</span> <span class="n">midiCmd</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">midiCmd</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
                <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">midiCmd</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">midiCmd</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">midiCmd</span><span class="o">[</span><span class="mi">4</span><span class="o">]);</span>
        <span class="nc">ProcessBuilder</span> <span class="n">midiBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProcessBuilder</span><span class="o">(</span><span class="n">midiCmd</span><span class="o">);</span>
        <span class="n">midiBuilder</span><span class="o">.</span><span class="na">redirectErrorStream</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

        <span class="nc">Process</span> <span class="n">midiProcess</span> <span class="o">=</span> <span class="n">midiBuilder</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">midiProcess</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="nc">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">));</span>

        <span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"=========================================="</span><span class="o">);</span>

        <span class="c1">// wav 파일 생성 후</span>
        <span class="nc">File</span> <span class="n">wavFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">wavPath</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">wavFile</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">wavFile</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">String</span><span class="o">[]</span> <span class="n">lameCmd</span> <span class="o">=</span> <span class="o">{</span><span class="s">"/usr/local/bin/lame"</span><span class="o">,</span> <span class="n">wavPath</span><span class="o">,</span> <span class="n">mp3Path</span><span class="o">};</span>
            <span class="nc">ProcessBuilder</span> <span class="n">lameBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProcessBuilder</span><span class="o">(</span><span class="n">lameCmd</span><span class="o">);</span>
            <span class="n">lameBuilder</span><span class="o">.</span><span class="na">redirectErrorStream</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

            <span class="nc">Process</span> <span class="n">lameProcess</span> <span class="o">=</span> <span class="n">lameBuilder</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="n">is</span> <span class="o">=</span> <span class="n">lameProcess</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">));</span>

            <span class="n">line</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="c1">// mp3 파일 있는지 체크</span>
            <span class="nc">File</span> <span class="n">mp3File</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">mp3Path</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(</span><span class="n">mp3File</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">mp3File</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt; Convert succeeded."</span><span class="o">);</span>
                <span class="n">wavFile</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getHash</span><span class="o">(</span><span class="nc">String</span> <span class="n">path</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">NoSuchAlgorithmException</span> <span class="o">{</span>

        <span class="nc">MessageDigest</span> <span class="n">messageDigest</span> <span class="o">=</span> <span class="nc">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"MD5"</span><span class="o">);</span>
        <span class="nc">FileInputStream</span> <span class="n">fileInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>

        <span class="kt">byte</span><span class="o">[]</span> <span class="n">dataBytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>

        <span class="nc">Integer</span> <span class="n">nRead</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">while</span><span class="o">((</span><span class="n">nRead</span> <span class="o">=</span> <span class="n">fileInputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">dataBytes</span><span class="o">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">messageDigest</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">dataBytes</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">nRead</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kt">byte</span><span class="o">[]</span> <span class="n">mdBytes</span> <span class="o">=</span> <span class="n">messageDigest</span><span class="o">.</span><span class="na">digest</span><span class="o">();</span>

        <span class="nc">StringBuffer</span> <span class="n">stringBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">mdBytes</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">stringBuffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">((</span><span class="n">mdBytes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="o">)</span> <span class="o">+</span> <span class="mh">0x100</span><span class="o">,</span> <span class="mi">16</span><span class="o">)).</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">stringBuffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">NoSuchAlgorithmException</span> <span class="o">{</span>

        <span class="nc">String</span> <span class="n">midiPath</span> <span class="o">=</span> <span class="s">"/Users/yoonbumtae/Documents/midi/canyon.mid"</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">mp3Path</span> <span class="o">=</span> <span class="s">"/Users/yoonbumtae/Documents/midi/mp3/canyon.mp3"</span><span class="o">;</span>

        <span class="nc">File</span> <span class="n">mp3Dir</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"/Users/yoonbumtae/Documents/midi/mp3/"</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">mp3Dir</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span>    <span class="n">mp3Dir</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">TimidityRunner</span><span class="o">.</span><span class="na">getHash</span><span class="o">(</span><span class="n">midiPath</span><span class="o">));</span>
        <span class="nc">TimidityRunner</span><span class="o">.</span><span class="na">convertMidiToMp3</span><span class="o">(</span><span class="n">midiPath</span><span class="o">,</span> <span class="n">mp3Path</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p> </p>

<h2 id="미디-정보-저장-테이블엔티티-생성"><span class="me-2"><strong>미디 정보 저장 테이블(엔티티) 생성</strong></span><a href="#미디-정보-저장-테이블엔티티-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>이전에 만들었던 <code class="language-plaintext highlighter-rouge">TimidityRunner</code>를 바탕으로 미디 플레이어를 만들기로 하였습니다. 미디 파일이 업로드되면 재생할 때마다 실시간 변환을 택할지, 아니면 mp3를 변환해둔 파일을 서버에 저장한 뒤 재생하는 방식을 택할지 둘 중 선택하다가 제가 현재 AWS EC2 프리티어 서비스를 이용하고 있고 지금 상황에서 실시간 변환은 서버에 부하가 많이 가기 때문에 사용자가 미디 파일을 업로드하면 서버에서 mp3를 저장하고, 나중에 플레이어에서 재생할 때 mp3 파일을 가져와 재생하는 방식을 택했습니다.</p>

<p>그러면 midi 파일과 mp3 파일의 경로, 원래 이름, 해시값 등을 저장하는 테이블(엔티티)가 새로 필요합니다. 참고로 재생 정보로 _카테고리_와 _사용자 지정 제목_이 있습니다. _카테고리_는 폴더와 비슷한 의미이고 _사용자 지정 제목_은 원래 파일명과 다른 이름을 사용자가 지정할 수 있다는 의미입니다.</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.example.awsboard.domain.midi</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.awsboard.domain.BaseTimeEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.web.dto.midi.MidiRequestDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Builder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Midi</span> <span class="kd">extends</span> <span class="nc">BaseTimeEntity</span> <span class="o">{</span>

    <span class="nd">@Id</span> <span class="c1">// PK 필드</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span> <span class="c1">// PK 생성규칙</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">userId</span><span class="o">;</span>    <span class="c1">// 업로드한 사람</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">category</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">customTitle</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">hash</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">originalMidiPath</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">originalMp3Path</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">originalFileName</span><span class="o">;</span>

    <span class="nd">@Builder</span>
    <span class="kd">public</span> <span class="nf">Midi</span><span class="o">(</span><span class="nc">Long</span> <span class="n">userId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">category</span><span class="o">,</span> <span class="nc">String</span> <span class="n">customTitle</span><span class="o">,</span>
                <span class="nc">String</span> <span class="n">hash</span><span class="o">,</span> <span class="nc">String</span> <span class="n">originalMidiPath</span><span class="o">,</span> <span class="nc">String</span> <span class="n">originalMp3Path</span><span class="o">,</span>
                <span class="nc">String</span> <span class="n">originalFileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="n">userId</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">customTitle</span> <span class="o">=</span> <span class="n">customTitle</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">originalMidiPath</span> <span class="o">=</span> <span class="n">originalMidiPath</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">originalMp3Path</span> <span class="o">=</span> <span class="n">originalMp3Path</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">originalFileName</span> <span class="o">=</span> <span class="n">originalFileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">MidiRequestDTO</span> <span class="n">dto</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// userid는 변경될 수 없음</span>
        <span class="k">this</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">dto</span><span class="o">.</span><span class="na">getCategory</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">dto</span><span class="o">.</span><span class="na">getCategory</span><span class="o">()</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">category</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">customTitle</span> <span class="o">=</span> <span class="n">dto</span><span class="o">.</span><span class="na">getCustomTitle</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">dto</span><span class="o">.</span><span class="na">getCustomTitle</span><span class="o">()</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">customTitle</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">hash</span> <span class="o">=</span> <span class="n">dto</span><span class="o">.</span><span class="na">getHash</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">dto</span><span class="o">.</span><span class="na">getHash</span><span class="o">()</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">hash</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">originalMidiPath</span> <span class="o">=</span> <span class="n">dto</span><span class="o">.</span><span class="na">getOriginalMidiPath</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">dto</span><span class="o">.</span><span class="na">getOriginalMidiPath</span><span class="o">()</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">originalMidiPath</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">originalMp3Path</span> <span class="o">=</span> <span class="n">dto</span><span class="o">.</span><span class="na">getOriginalMp3Path</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">dto</span><span class="o">.</span><span class="na">getOriginalMp3Path</span><span class="o">()</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">originalMp3Path</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></div></div>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.example.awsboard.domain.midi</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MidiRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Midi</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nc">Midi</span> <span class="nf">findByHash</span><span class="o">(</span><span class="nc">String</span> <span class="n">hash</span><span class="o">);</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></div></div>

<p> </p>

<h2 id="midi-엔티티의-서비스-클래스-작성"><span class="me-2"><strong>Midi 엔티티의 서비스 클래스 작성</strong></span><a href="#midi-엔티티의-서비스-클래스-작성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.example.awsboard.service.posts</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.awsboard.domain.midi.Midi</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.domain.midi.MidiRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.web.dto.midi.MidiPublicResponseDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.web.dto.midi.MidiRequestDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.web.dto.midi.MidiResponseDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MidiService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MidiRepository</span> <span class="n">midiRepository</span><span class="o">;</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">save</span><span class="o">(</span><span class="nc">MidiRequestDTO</span> <span class="n">requestDTO</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">midiRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">requestDTO</span><span class="o">.</span><span class="na">toEnity</span><span class="o">()).</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">MidiRequestDTO</span> <span class="n">requestDTO</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Midi</span> <span class="n">midi</span> <span class="o">=</span> <span class="n">midiRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">"해당 파일이 없습니다. id="</span> <span class="o">+</span> <span class="n">id</span><span class="o">));</span>
        <span class="n">midi</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">requestDTO</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">midi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Midi</span> <span class="n">midi</span> <span class="o">=</span> <span class="n">midiRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">"해당 파일이 없습니다. id="</span> <span class="o">+</span> <span class="n">id</span><span class="o">));</span>
        <span class="n">midiRepository</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">midi</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">MidiResponseDTO</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Midi</span> <span class="n">midi</span> <span class="o">=</span> <span class="n">midiRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
                <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">"해당 파일이 없습니다. id="</span> <span class="o">+</span> <span class="n">id</span><span class="o">));</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">MidiResponseDTO</span><span class="o">(</span><span class="n">midi</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">MidiPublicResponseDTO</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">midiRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">MidiPublicResponseDTO:</span><span class="o">:</span><span class="k">new</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>

</pre></td></tr></tbody></table></code></div></div>

<p>CRUD에 대응할 수 있는 서비스를 작성하였습니다. 현재는 업로드 및 목록 받기, mp3 파일 받기만 가능하지만 나중을 위해 update, delete도 미리 만들었습니다.</p>

<p> </p>

<h2 id="미디파일-업로드-api-구현"><span class="me-2"><strong>미디파일 업로드 API 구현</strong></span><a href="#미디파일-업로드-api-구현" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>미디파일을 여러 개 업로드할 수 있는 기능을 구현하였습니다. <a href="/posts/스프링-부트spring-boot-파일-업로드-처리하기-한-개-여러-개/">스프링 부트(Spring Boot): 파일 업로드 처리하기 (한 개, 여러 개)</a> 이 글을 참고해 미디파일을 <code class="language-plaintext highlighter-rouge">MultipartFile</code> 리스트로 여러 개 받을 수 있도록 하였습니다. 카테고리 및 사용자 지정 제목 정보도 받을 수 있게 제작하였습니다.</p>

<p>현재는 <code class="language-plaintext highlighter-rouge">MultipartFile</code>로 되어있지만 미디 파일은 대부분 파일 크기가 매우 작기(수십 KB 단위가 대부분입니다.) 때문에 나중에 BASE64 포맷을 이용해 업로드 방식을 변경할지 고려하고 있습니다. 원래 파일 크기가 작아서 BASE64로 변환해도 오버헤드가 적고 JSON 에 포함해서 보낼 수 있기 때문에 이점이 있습니다.</p>

<p>컨트롤러 내의 <code class="language-plaintext highlighter-rouge">PostMapping</code> 부분입니다.</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.example.awsboard.web</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.awsboard.config.auth.LoginUser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.config.auth.dto.SessionUser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.service.posts.MidiService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.util.TimidityRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.web.dto.midi.MidiPublicResponseDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.web.dto.midi.MidiRequestDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.awsboard.web.dto.midi.MidiResponseDTO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.filechooser.FileSystemView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.URLEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MidiApiController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MidiService</span> <span class="n">midiService</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">DEFAULT_URI</span> <span class="o">=</span> <span class="s">"/api/v1/midi"</span><span class="o">;</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="no">DEFAULT_URI</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">uploadMultipleMidi</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"files"</span><span class="o">)</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">MultipartFile</span><span class="o">&gt;</span> <span class="n">files</span><span class="o">,</span>
                                           <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"categories"</span><span class="o">)</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">,</span>
                                           <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"titles"</span><span class="o">)</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">titles</span><span class="o">,</span>
                                           <span class="nd">@LoginUser</span> <span class="nc">SessionUser</span> <span class="n">user</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">rootPath</span> <span class="o">=</span> <span class="nc">FileSystemView</span><span class="o">.</span><span class="na">getFileSystemView</span><span class="o">().</span><span class="na">getHomeDirectory</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">basePath</span> <span class="o">=</span> <span class="n">rootPath</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="s">"app/midi"</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">ourUrl</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">(),</span><span class="s">""</span><span class="o">);</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

        <span class="k">if</span><span class="o">(</span><span class="n">files</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span> <span class="s">"NoFile"</span><span class="o">);</span>
            <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"successList"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"failedList"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span><span class="o">(!</span><span class="n">user</span><span class="o">.</span><span class="na">getRole</span><span class="o">().</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"ADMIN"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">files</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span> <span class="s">"NotAllowManyFile"</span><span class="o">);</span>
            <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"successList"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"failedList"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt;&gt; "</span> <span class="o">+</span> <span class="n">rootPath</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt;&gt; "</span> <span class="o">+</span> <span class="n">basePath</span><span class="o">);</span>

        <span class="nc">File</span> <span class="n">originalDir</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">basePath</span> <span class="o">+</span> <span class="s">"/original"</span><span class="o">);</span>
        <span class="nc">File</span> <span class="n">mp3Dir</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">basePath</span> <span class="o">+</span> <span class="s">"/mp3"</span><span class="o">);</span>

        <span class="c1">// 디렉토리가 없으면 만든다.</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">originalDir</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">originalDir</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"mkdirs: original"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">mp3Dir</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">mp3Dir</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"mkdirs: mp3"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">successList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">urlList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">failedList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="nc">MultipartFile</span> <span class="n">file</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">files</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>

            <span class="n">file</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>

            <span class="nc">String</span> <span class="n">originalName</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="n">basePath</span> <span class="o">+</span> <span class="s">"/original/"</span> <span class="o">+</span> <span class="n">originalName</span><span class="o">;</span>
            <span class="c1">// String mp3Name = file.getOriginalFilename().substring(0, originalName.lastIndexOf("."));</span>
            <span class="nc">String</span> <span class="n">mp3Name</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">mp3Path</span> <span class="o">=</span> <span class="n">basePath</span> <span class="o">+</span> <span class="s">"/mp3/"</span> <span class="o">+</span> <span class="n">mp3Name</span><span class="o">+</span> <span class="s">".mp3"</span><span class="o">;</span>

            <span class="nc">File</span> <span class="n">dest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">filePath</span><span class="o">);</span>
            <span class="n">file</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">dest</span><span class="o">);</span>

            <span class="c1">// 변환</span>
            <span class="nc">Boolean</span> <span class="n">isConverted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">isConverted</span> <span class="o">=</span> <span class="nc">TimidityRunner</span><span class="o">.</span><span class="na">convertMidiToMp3</span><span class="o">(</span><span class="n">filePath</span><span class="o">,</span> <span class="n">mp3Path</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
                <span class="n">isConverted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">// 변환 성공시 데이터베이스에 정보 입력</span>
            <span class="k">if</span><span class="o">(</span><span class="n">isConverted</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">midiService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="nc">MidiRequestDTO</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">category</span><span class="o">(</span><span class="n">categories</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">))</span>
                        <span class="o">.</span><span class="na">customTitle</span><span class="o">(</span><span class="n">titles</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">))</span>
                        <span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="nc">TimidityRunner</span><span class="o">.</span><span class="na">getHash</span><span class="o">(</span><span class="n">filePath</span><span class="o">))</span>
                        <span class="o">.</span><span class="na">originalMidiPath</span><span class="o">(</span><span class="s">"/original/"</span> <span class="o">+</span> <span class="n">originalName</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">originalMp3Path</span><span class="o">(</span><span class="s">"/mp3/"</span> <span class="o">+</span> <span class="n">mp3Name</span><span class="o">+</span> <span class="s">".mp3"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">originalFileName</span><span class="o">(</span><span class="n">originalName</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">userId</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span>
                        <span class="o">.</span><span class="na">build</span><span class="o">());</span>
                <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">urlPair</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
                <span class="n">urlPair</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"originalName"</span><span class="o">,</span> <span class="n">originalName</span><span class="o">);</span>
                <span class="n">urlPair</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"url"</span><span class="o">,</span> <span class="n">ourUrl</span> <span class="o">+</span> <span class="s">"/api/v1/midi/mp3/"</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
                <span class="n">successList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">urlPair</span><span class="o">);</span>

            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">failedList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">originalName</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">if</span><span class="o">(</span><span class="n">successList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">failedList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span> <span class="s">"AllFileSuccess"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">successList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">failedList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span> <span class="s">"SomeFileSuccess"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">successList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span> <span class="s">"AllFileFailed"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"successList"</span><span class="o">,</span> <span class="n">successList</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"failedList"</span><span class="o">,</span> <span class="n">failedList</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt;&gt;&gt;&gt;&gt; Auth user &gt;&gt;&gt;&gt;&gt; "</span> <span class="o">+</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// ............... //</span>

<span class="o">}</span>

</pre></td></tr></tbody></table></code></div></div>

<p> </p>

<p>미디 파일과 부가 정보를 파라미터로 가져온 후, 파일이 정상적으로 변환되었으면 <code class="language-plaintext highlighter-rouge">successList</code>에 넣고, 실패하거나 예외가 발생하면 <code class="language-plaintext highlighter-rouge">failedList</code>에 넣습니다. 변환이 다 끝나면 변환 상태 메시지와 성공/실패 목록을 JSON으로 반환합니다.</p>

<p>HTML 뷰에서도 처리하였지만 업로드된 파일이 0개이면 작업을 진행하지 않도록 하도록 처리하였습니다. 또 일반 회원(USER)은 최대 5개까지만 업로드하도록 하였습니다. (누가 이 글을 볼 것이며 회원가입까지 해서 업로드할지는 모르겠으나..) 저는 ADMIN 계정이기 때문에 무한대로 업로드할 수 있습니다.</p>

<p>기타 컨트롤러단에서 발생할 수 있는 돌발 상황에 대한 대비는 추가적으로 계속 할 예정입니다.</p>

<p>약간 특이한 부분이라면 MP3 파일 이름을 저장할 때 <code class="language-plaintext highlighter-rouge">UUID.randomUUID().toString();</code> 를 사용해 고유 값으로 지정했다는 점입니다. DB에 저장하고 나중에 아이디를 바탕으로 특정 mp3 파일을 가져올 때 사용합니다.</p>

<p> </p>

<h2 id="업로드-뷰-페이지thymeleaf"><span class="me-2"><strong>업로드 뷰 페이지(Thymeleaf)</strong></span><a href="#업로드-뷰-페이지thymeleaf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-html highlighter-rouge"><div class="code-header">
        <span data-label-text="HTML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>

<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>미디파일 업로드<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"</span> <span class="na">integrity=</span><span class="s">"sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
        <span class="nf">#info-tr-proto</span> <span class="p">{</span>
            <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"mt-2"</span><span class="nt">&gt;</span>파일 업로드<span class="nt">&lt;/h2&gt;</span>

        <span class="c">&lt;!-- &lt;form method="post" action="/api/v1/midi/" enctype="multipart/form-data"&gt;--&gt;</span>
        <span class="c">&lt;!-- &lt;input multiple type="file" name="files" id="field-file"&gt;--&gt;</span>
        <span class="c">&lt;!-- &lt;input name="customTitle" value="eee"&gt;--&gt;</span>
        <span class="c">&lt;!-- &lt;input name="userId" value="33"&gt;--&gt;</span>
        <span class="c">&lt;!-- &lt;button&gt;submit&lt;/button&gt;--&gt;</span>
        <span class="c">&lt;!-- &lt;/form&gt;--&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"col-form-label"</span> <span class="na">for=</span><span class="s">"field-file"</span><span class="nt">&gt;</span>업로드할 파일 선택<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-group mb-3"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"custom-file"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">class=</span><span class="s">"custom-file-input"</span> <span class="na">id=</span><span class="s">"field-file"</span> <span class="na">multiple</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"custom-file-label"</span> <span class="na">for=</span><span class="s">"field-file"</span><span class="nt">&gt;</span>파일을 선택하세요.<span class="nt">&lt;/label&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"col-form-label"</span> <span class="na">for=</span><span class="s">"field-custom-category"</span><span class="nt">&gt;</span>카테고리 일괄변경<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-group mb-3"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"custom-file"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">placeholder=</span><span class="s">"카테고리명을 입력하세요."</span> <span class="na">id=</span><span class="s">"field-custom-category"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-group-append"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"input-group-text"</span> <span class="na">id=</span><span class="s">"btn-change-category"</span><span class="nt">&gt;</span>변경<span class="nt">&lt;/button&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>

                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-secondary"</span> <span class="na">id=</span><span class="s">"btn-reset"</span><span class="nt">&gt;</span>초기화<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="na">id=</span><span class="s">"btn-upload"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"spinner spinner-border spinner-border-sm"</span> <span class="na">role=</span><span class="s">"status"</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/span&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"message"</span><span class="nt">&gt;</span>모든 파일 업로드<span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-hover"</span> <span class="na">id=</span><span class="s">"table-info"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;thead&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>파일명<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>카테고리<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>사용자 설정 제목<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>크기<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/thead&gt;</span>
            <span class="nt">&lt;tbody</span> <span class="na">id=</span><span class="s">"table-info-tbody"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tr</span> <span class="na">id=</span><span class="s">"info-tr-proto"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"row"</span> <span class="na">class=</span><span class="s">"file-name"</span><span class="nt">&gt;</span>Default<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"category"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"카테고리명을 입력하세요."</span> <span class="na">class=</span><span class="s">"form-control form-control-sm"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"custom-title"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"제목을 입력하세요."</span> <span class="na">class=</span><span class="s">"form-control form-control-sm"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"file-size"</span><span class="nt">&gt;</span>Column content<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>

            <span class="nt">&lt;/tbody&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal"</span> <span class="na">tabindex=</span><span class="s">"-1"</span> <span class="na">role=</span><span class="s">"dialog"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-dialog"</span> <span class="na">role=</span><span class="s">"document"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-content"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-header"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"modal-title"</span><span class="nt">&gt;</span>업로드 결과<span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span> <span class="na">aria-label=</span><span class="s">"Close"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;span</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/button&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-body"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"upload-result"</span><span class="nt">&gt;</span>성공/실패<span class="nt">&lt;/p&gt;</span>
                        <span class="nt">&lt;p&gt;</span>성공: <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"success-count"</span><span class="nt">&gt;</span>0<span class="nt">&lt;/span&gt;&lt;/p&gt;</span>
                        <span class="nt">&lt;p&gt;</span>실패: <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"failed-count"</span><span class="nt">&gt;</span>0<span class="nt">&lt;/span&gt;&lt;/p&gt;</span>
                        <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/midi/list}"</span><span class="nt">&gt;</span>미디파일 목록 가기<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-footer"</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!-- &lt;button type="button" class="btn btn-primary"&gt;Save changes&lt;/button&gt;--&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-secondary"</span> <span class="na">data-dismiss=</span><span class="s">"modal"</span><span class="nt">&gt;</span>Close<span class="nt">&lt;/button&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://code.jquery.com/jquery-3.5.1.min.js"</span> <span class="na">integrity=</span><span class="s">"sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"</span> <span class="na">integrity=</span><span class="s">"sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#btn-upload .spinner</span><span class="dl">"</span><span class="p">).</span><span class="nf">hide</span><span class="p">()</span>

        <span class="kd">const</span> <span class="nx">tbody</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#table-info-tbody</span><span class="dl">"</span><span class="p">)</span>
        
        <span class="kd">function</span> <span class="nf">resetAll</span><span class="p">()</span> <span class="p">{</span>
            <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#field-file</span><span class="dl">"</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">""</span>
            <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#table-info-tbody tr:not(#info-tr-proto)</span><span class="dl">"</span><span class="p">).</span><span class="nf">remove</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#field-file</span><span class="dl">"</span><span class="p">).</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">change</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#field-file</span><span class="dl">"</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">resetAll</span><span class="p">()</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#table-info-tbody tr:not(#info-tr-proto)</span><span class="dl">"</span><span class="p">).</span><span class="nf">remove</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="kd">const</span> <span class="nx">evTarget</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">evTarget</span><span class="p">.</span><span class="nx">files</span><span class="p">)</span>
            <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">evTarget</span><span class="p">.</span><span class="nx">files</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">file</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">if </span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">audio/midi</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">const</span> <span class="nx">clone</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#info-tr-proto</span><span class="dl">"</span><span class="p">).</span><span class="nf">clone</span><span class="p">()</span>

                    <span class="nx">clone</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.file-name</span><span class="dl">"</span><span class="p">).</span><span class="nf">text</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
                    <span class="nx">clone</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.category input</span><span class="dl">"</span><span class="p">).</span><span class="nf">val</span><span class="p">(</span><span class="dl">"</span><span class="s2">Uploaded</span><span class="dl">"</span><span class="p">)</span>

                    <span class="kd">const</span> <span class="nx">fileNameWithoutExt</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nf">lastIndexOf</span><span class="p">(</span><span class="dl">"</span><span class="s2">.</span><span class="dl">"</span><span class="p">))</span>
                    <span class="nx">clone</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.custom-title input</span><span class="dl">"</span><span class="p">).</span><span class="nf">val</span><span class="p">(</span><span class="nx">fileNameWithoutExt</span><span class="p">)</span>
                    <span class="nx">clone</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.file-size</span><span class="dl">"</span><span class="p">).</span><span class="nf">text</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">ceil</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">size</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> KB</span><span class="dl">"</span><span class="p">)</span>
                    <span class="nx">clone</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
                    <span class="nx">clone</span><span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">)</span>

                    <span class="nx">tbody</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nx">clone</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="dl">"</span><span class="s2">미디 파일만 업로드할 수 있습니다.</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="p">})</span>

        <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#btn-change-category</span><span class="dl">"</span><span class="p">).</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">catStr</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#field-custom-category</span><span class="dl">"</span><span class="p">).</span><span class="nf">val</span><span class="p">()</span>
            <span class="nx">tbody</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.category input</span><span class="dl">"</span><span class="p">).</span><span class="nf">val</span><span class="p">(</span><span class="nx">catStr</span> <span class="o">!==</span> <span class="dl">""</span> <span class="p">?</span> <span class="nx">catStr</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Uploaded</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">})</span>

        <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#btn-upload</span><span class="dl">"</span><span class="p">).</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">files</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#field-file</span><span class="dl">"</span><span class="p">).</span><span class="nf">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">files</span>

            <span class="k">if</span><span class="p">(</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">업로드할 파일을 선택하세요.</span><span class="dl">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="p">}</span>

            <span class="kd">const</span> <span class="nx">categories</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#table-info-tbody tr:not(#info-tr-proto) .category input</span><span class="dl">"</span><span class="p">).</span><span class="nf">map</span><span class="p">((</span><span class="nx">i</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nf">val</span><span class="p">())</span>
            <span class="kd">const</span> <span class="nx">titles</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#table-info-tbody tr:not(#info-tr-proto) .custom-title input</span><span class="dl">"</span><span class="p">).</span><span class="nf">map</span><span class="p">((</span><span class="nx">i</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nf">val</span><span class="p">())</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">categories</span><span class="p">,</span> <span class="nx">titles</span><span class="p">)</span>

            <span class="kd">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FormData</span><span class="p">()</span>
            <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">files</span><span class="p">).</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">file</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">formData</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">files</span><span class="dl">"</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span>
                <span class="nx">formData</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">categories</span><span class="dl">"</span><span class="p">,</span> <span class="nx">categories</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
                <span class="nx">formData</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">titles</span><span class="dl">"</span><span class="p">,</span> <span class="nx">titles</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="p">})</span>

            <span class="kd">const</span> <span class="nx">entries</span> <span class="o">=</span> <span class="nx">formData</span><span class="p">.</span><span class="nf">entries</span><span class="p">()</span>

            <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#btn-upload .spinner</span><span class="dl">"</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
            <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#btn-upload .message</span><span class="dl">"</span><span class="p">).</span><span class="nf">text</span><span class="p">(</span><span class="dl">"</span><span class="s2">작업을 처리하고 있습니다.....</span><span class="dl">"</span><span class="p">)</span>
            <span class="nf">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/v1/midi/</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
                    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">body</span><span class="p">:</span> <span class="nx">formData</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">())</span>
                <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>

                    <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">NotAllowManyFile</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nf">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">일반 회원은 최대 5개의 파일만 업로드할 수 우 있습니다.</span><span class="dl">"</span><span class="p">)</span>
                        <span class="k">return</span>
                    <span class="p">}</span>
                
                    <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.modal</span><span class="dl">"</span><span class="p">).</span><span class="nf">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.upload-result</span><span class="dl">"</span><span class="p">).</span><span class="nf">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span>
                    <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.modal</span><span class="dl">"</span><span class="p">).</span><span class="nf">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.success-count</span><span class="dl">"</span><span class="p">).</span><span class="nf">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">successList</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
                    <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.modal</span><span class="dl">"</span><span class="p">).</span><span class="nf">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.failed-count</span><span class="dl">"</span><span class="p">).</span><span class="nf">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">failedList</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
                    <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.modal</span><span class="dl">"</span><span class="p">).</span><span class="nf">modal</span><span class="p">(</span><span class="dl">"</span><span class="s2">show</span><span class="dl">"</span><span class="p">)</span>
                
                    <span class="nf">resetAll</span><span class="p">()</span>

                <span class="p">})</span>
                <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
                
                    <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.modal</span><span class="dl">"</span><span class="p">).</span><span class="nf">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.upload-result</span><span class="dl">"</span><span class="p">).</span><span class="nf">text</span><span class="p">(</span><span class="dl">"</span><span class="s2">파일 전송에 실패했습니다.</span><span class="dl">"</span><span class="p">)</span>
                    <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.modal</span><span class="dl">"</span><span class="p">).</span><span class="nf">modal</span><span class="p">(</span><span class="dl">"</span><span class="s2">show</span><span class="dl">"</span><span class="p">)</span>
                
                    <span class="nf">resetAll</span><span class="p">()</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#btn-upload .spinner</span><span class="dl">"</span><span class="p">).</span><span class="nf">hide</span><span class="p">()</span>
                    <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#btn-upload .message</span><span class="dl">"</span><span class="p">).</span><span class="nf">text</span><span class="p">(</span><span class="dl">"</span><span class="s2">모든 파일 업로드</span><span class="dl">"</span><span class="p">)</span>
                
                <span class="p">})</span>
        <span class="p">})</span>
        
        <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#btn-reset</span><span class="dl">"</span><span class="p">).</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nf">resetAll</span><span class="p">()</span>
        <span class="p">})</span>

    <span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>

</pre></td></tr></tbody></table></code></div></div>

<p> </p>

<p>대충 요약하자면 파일 업로드하면 목록으로 받고 카테고리, 제목 정보 수정할 수 있고, 파일과 정보를 한 번에 모아 업로드 할 수 있는 기능이 있는 페이지 입니다.</p>

<p>JS, CSS는 추후 기능 보강이 되고 안정화되면 분리할 예정입니다.</p>

<p> </p>

<p><a href="/assets/img/wp-content/uploads/2020/08/screenshot-2020-08-15-pm-1.08.23.png" class="popup img-link shimmer"><img src="/assets/img/wp-content/uploads/2020/08/screenshot-2020-08-15-pm-1.08.23.png" alt="" loading="lazy"></a></p>

<p>업로드에서 미디 파일을 여러 개 선택하면 위 그림처럼 리스트가 뜹니다. 워크래프트 2 배경음악 파일이라서 카테고리를 “Warcraft II” 로 일괄 변경하였습니다. 업로드 버튼을 누르면 버튼에 로딩 이미지가 추가됩니다. 업로드가 완료되면 결과창이 나옵니다.</p>

<p><a href="/assets/img/wp-content/uploads/2020/08/screenshot-2020-08-15-pm-1.10.09.png" class="popup img-link shimmer"><img src="/assets/img/wp-content/uploads/2020/08/screenshot-2020-08-15-pm-1.10.09.png" alt="" loading="lazy"></a></p>

<p><a href="/assets/img/wp-content/uploads/2020/08/screenshot-2020-08-15-pm-1.10.28.png" class="popup img-link shimmer"><img src="/assets/img/wp-content/uploads/2020/08/screenshot-2020-08-15-pm-1.10.28.png" alt="업로드 결과를 JSON 으로 반환" loading="lazy"></a><br />
<em>업로드 결과를 JSON 으로 반환</em></p>

<p> </p>

<h2 id="변환된-mp3-파일을-클라이언트로-보내는-api-만들기"><span class="me-2"><strong>변환된 MP3 파일을 클라이언트로 보내는 API 만들기</strong></span><a href="#변환된-mp3-파일을-클라이언트로-보내는-api-만들기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>크롬에서 구간 탐색(seeking)이 가능하게 하려면 response header 설정을 해야 합니다. ”Accept-ranges”를 ”bytes”로 설정하고, ”Content-Length”에 바이트 단위로 파일 길이를 넣어주면 됩니다. (<a href="https://developer.mozilla.org/ko/docs/Web/HTTP/Range_requests">MDN 링크</a>)</p>

<p>ㅂㅅ같은 사파리 브라우저때문에 이 부분은 문제가 많이 복잡해서 설명 및 코드는 별도의 글에서 설명하겠습니다.</p>

<ul>
  <li><a href="/posts/스프링-부트-spring-boot-mp3을-전송하는-컨트롤러-크롬-및-사파/">스프링 부트 (Spring Boot): mp3을 전송하는 컨트롤러 – 크롬 및 사파리(Safari) 브라우저에서 구간 탐색이 안되는 문제 해결 방법</a></li>
</ul>

<p> </p>

<h2 id="미디-재생-플레이어-페이지임시-만들기"><span class="me-2"><strong>미디 재생 플레이어 페이지(임시) 만들기</strong></span><a href="#미디-재생-플레이어-페이지임시-만들기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-html highlighter-rouge"><div class="code-header">
        <span data-label-text="HTML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>

<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>미디파일 업로드<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"</span> <span class="na">integrity=</span><span class="s">"sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
        <span class="nc">.song-title</span> <span class="p">{</span>
            <span class="nl">cursor</span><span class="p">:</span> <span class="nb">pointer</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nf">#audio-player</span> <span class="p">{</span>
            <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row mt-3"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-7"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h2&gt;</span>미디파일 목록 (임시)<span class="nt">&lt;/h2&gt;</span>
                <span class="nt">&lt;p&gt;</span>제목을 클릭하면 재생됩니다. <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/midi/upload}"</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-sm"</span><span class="nt">&gt;</span>업로드<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-5"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div&gt;</span>
                    <span class="nt">&lt;audio</span> <span class="na">id=</span><span class="s">"audio-player"</span> <span class="na">controls</span><span class="nt">&gt;&lt;/audio&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-hover"</span> <span class="na">id=</span><span class="s">"table-info"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;thead&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>ID<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>제목<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>업로더<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/thead&gt;</span>
            <span class="nt">&lt;tbody</span> <span class="na">id=</span><span class="s">"table-info-tbody"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/tbody&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;script&gt;</span>
        <span class="kd">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="p">[{</span>
                <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">userId</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">category</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Uploaded</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">customTitle</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">amazonia</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">originalFileName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">amazonia.mid</span><span class="dl">"</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">userId</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">category</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Uploaded</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">customTitle</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ample</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">originalFileName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ample.mid</span><span class="dl">"</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">userId</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">category</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Uploaded</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">customTitle</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">arsenal-mixed-4bell-mid0</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">originalFileName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">arsenal-mixed-4bell-mid0.mid</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">]</span>

        <span class="nf">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/v1/midi</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">())</span>
            <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">data</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">song</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="kd">const</span> <span class="nx">$tr</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">tr</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">$tr</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">`&lt;th scope="row"&gt;</span><span class="p">${</span><span class="nx">song</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">&lt;/th&gt;
                    &lt;td class="song-title" data-id=</span><span class="p">${</span><span class="nx">song</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">&gt;&lt;span class="text-muted"&gt;[</span><span class="p">${</span><span class="nx">song</span><span class="p">.</span><span class="nx">category</span><span class="p">}</span><span class="s2">]&lt;/span&gt; </span><span class="p">${</span><span class="nx">song</span><span class="p">.</span><span class="nx">customTitle</span><span class="p">}</span><span class="s2">&lt;/td&gt;
                    &lt;td&gt;</span><span class="p">${</span><span class="nx">song</span><span class="p">.</span><span class="nx">userId</span><span class="p">}</span><span class="s2">&lt;/td&gt;`</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">table-info-tbody</span><span class="dl">"</span><span class="p">).</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">$tr</span><span class="p">)</span>

                <span class="p">})</span>
            <span class="p">})</span>

        <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">"</span><span class="s2">song-title</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
                <span class="kd">const</span> <span class="nx">audio</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">audio-player</span><span class="dl">"</span><span class="p">)</span>
                <span class="nx">audio</span><span class="p">.</span><span class="nf">pause</span><span class="p">()</span>
                <span class="nx">audio</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="kc">false</span>
                <span class="nx">audio</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/api/v1/midi/mp3/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span>
                <span class="c1">// audio.src = "http://cld3097web.audiovideoweb.com/va90web25003/companions/Foundations%20of%20Rock/13.01.mp3"</span>
                <span class="nx">audio</span><span class="p">.</span><span class="nf">play</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>

</pre></td></tr></tbody></table></code></div></div>

<p>일단 ‘재생 기능만 구현’이라는 목적 하에 만들었습니다. 제목을 클릭하면 업로드된 노래가 재생이 됩니다.</p>

<p><a href="/assets/img/wp-content/uploads/2020/08/screenshot-2020-08-15-pm-5.21.35.png" class="popup img-link shimmer"><img src="/assets/img/wp-content/uploads/2020/08/screenshot-2020-08-15-pm-5.21.35.png" alt="" loading="lazy"></a></p>

<style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style>
<div class="embed-container">    <iframe title="YouTube video player" width="640" height="390" src="//www.youtube.com/embed/xUl4sOQkBno" frameborder="0" allowfullscreen=""></iframe></div>

<p>아이폰에서도 정상 재생되며 백그라운드에서도 정상 동작 합니다.</p>

<!-- 제가 예전에 만들었던 라이브러리를 사용한 [미디 플레이어](http://y1oonbumtae.com/music/midi/)는 백그라운드 재생이 안되었는데, 이 점은 해결된 것 같습니다. -->

<p>앞으로 구현할 내용은 다음과 같습니다.</p>

<ul>
  <li>미디파일 정보 수정, 미디파일 삭제</li>
  <li>연속 재생 기능</li>
  <li>구간 반복 재생 기능</li>
  <li>사용자별 플레이리스트 기능(추가, 변경, 삭제)</li>
</ul>

<h2 id="가능한-추가-작업"><span class="me-2"><strong>가능한 추가 작업</strong></span><a href="#가능한-추가-작업" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>여유가 된다면 언젠가는 다음 기능도 시도해볼 예정입니다.</p>

<ul>
  <li>그래픽 이퀄라이저</li>
  <li>사용자별로 MIDI 파일에 대한 재생 속도, 음높이, 리버브 변경 정보를 저장하고 재생하는 사용자 맞춤 재생 기능</li>
  <li>미디파일 업로드 포맷을 BASE64로 변경</li>
  <li>결제 기능 (업로드 한도 해제, 광고 제거 등)</li>
  <li>변환 과정 실시간 통보 기능</li>
</ul>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/devlog/">DevLog</a>,
          <a href="/categories/spring-jsp/">Spring/JSP</a>
      </div>
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=%EC%8A%A4%ED%94%84%EB%A7%81%20%EB%B6%80%ED%8A%B8(Spring%20Boot)%20%EB%AF%B8%EB%94%94%20%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4%20%EB%A7%8C%EB%93%A4%EA%B8%B0%20(2):%20%EC%97%85%EB%A1%9C%EB%93%9C%20%ED%8E%98%EC%9D%B4%EC%A7%80,%20%EC%9E%84%EC%8B%9C%20%EC%9E%AC%EC%83%9D%20%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4%20%EB%A7%8C%EB%93%A4%EA%B8%B0%20-%20BGSMM&url=https%3A%2F%2Fayaysir.github.io%2Fposts%2F%25EC%258A%25A4%25ED%2594%2584%25EB%25A7%2581-%25EB%25B6%2580%25ED%258A%25B8spring-boot-%25EB%25AF%25B8%25EB%2594%2594-%25ED%2594%258C%25EB%25A0%2588%25EC%259D%25B4%25EC%2596%25B4-%25EB%25A7%258C%25EB%2593%25A4%25EA%25B8%25B0-1-%25EC%2597%2585%25EB%25A1%259C%25EB%2593%259C-%25ED%258E%2598%25EC%259D%25B4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=%EC%8A%A4%ED%94%84%EB%A7%81%20%EB%B6%80%ED%8A%B8(Spring%20Boot)%20%EB%AF%B8%EB%94%94%20%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4%20%EB%A7%8C%EB%93%A4%EA%B8%B0%20(2):%20%EC%97%85%EB%A1%9C%EB%93%9C%20%ED%8E%98%EC%9D%B4%EC%A7%80,%20%EC%9E%84%EC%8B%9C%20%EC%9E%AC%EC%83%9D%20%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4%20%EB%A7%8C%EB%93%A4%EA%B8%B0%20-%20BGSMM&u=https%3A%2F%2Fayaysir.github.io%2Fposts%2F%25EC%258A%25A4%25ED%2594%2584%25EB%25A7%2581-%25EB%25B6%2580%25ED%258A%25B8spring-boot-%25EB%25AF%25B8%25EB%2594%2594-%25ED%2594%258C%25EB%25A0%2588%25EC%259D%25B4%25EC%2596%25B4-%25EB%25A7%258C%25EB%2593%25A4%25EA%25B8%25B0-1-%25EC%2597%2585%25EB%25A1%259C%25EB%2593%259C-%25ED%258E%2598%25EC%259D%25B4%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=https%3A%2F%2Fayaysir.github.io%2Fposts%2F%25EC%258A%25A4%25ED%2594%2584%25EB%25A7%2581-%25EB%25B6%2580%25ED%258A%25B8spring-boot-%25EB%25AF%25B8%25EB%2594%2594-%25ED%2594%258C%25EB%25A0%2588%25EC%259D%25B4%25EC%2596%25B4-%25EB%25A7%258C%25EB%2593%25A4%25EA%25B8%25B0-1-%25EC%2597%2585%25EB%25A1%259C%25EB%2593%259C-%25ED%258E%2598%25EC%259D%25B4%2F&text=%EC%8A%A4%ED%94%84%EB%A7%81%20%EB%B6%80%ED%8A%B8(Spring%20Boot)%20%EB%AF%B8%EB%94%94%20%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4%20%EB%A7%8C%EB%93%A4%EA%B8%B0%20(2):%20%EC%97%85%EB%A1%9C%EB%93%9C%20%ED%8E%98%EC%9D%B4%EC%A7%80,%20%EC%9E%84%EC%8B%9C%20%EC%9E%AC%EC%83%9D%20%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4%20%EB%A7%8C%EB%93%A4%EA%B8%B0%20-%20BGSMM" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/visit-tistory/">티스토리 블로그로 이사: 이 블로그는 당분간 2017년 ~ 2025년 작성 포스트의 아카이브로 운영됩니다.</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/scrollview-resize-fit-contents/">SwiftUI: 콘텐츠에 맞게 ScrollView 크기를 조절하는 방법 및 최대 높이 지정</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/xcode-where-is-infoplist/">Xcode 에서 Info.plist 파일이 없을 때</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/swift-urlscheme/">Swift: iOS에서 Custom URL Scheme 등록해서 url로 앱 열기</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/swift-translation/">SwiftUI: 번역 기능 (Translation) 사용하기 (iOS 18 이상)</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/audiokit/">AudioKit</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9D%8C%ED%96%A5%EC%9D%B4%EB%A1%A0/">음향이론</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/java/">java</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8/">자바스크립트</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/spring-boot/">spring-boot</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vue-js/">vue-js</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9E%90%EB%B0%94/">자바</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/qbasic-%EA%B8%B0%EC%B4%88/">qbasic-기초</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/spring-jstl-div-%ED%83%9C%EA%B7%B8%EB%A1%9C-%EC%9D%B4%EB%A3%A8%EC%96%B4%EC%A7%84-%EC%9D%B4%EC%A4%91-%EB%B0%98%EB%B3%B5%EB%AC%B8-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0-%ED%8A%B9%EC%A0%95-%EA%B0%9C/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1561474800"
  data-df="ll"
  
>
  Jun 26, 2019
</time>

              <h4 class="pt-0 my-2">Spring, JSTL: div 태그로 이루어진 이중 반복문 사용하기 (특정 개수별 구분)</h4>
              <div class="text-muted">
                <p>문제점  예를 들어 15개마다 줄바꿈이 되는 이런 모양의 웹 페이지를 만들고 싶은데, 사용 태그가 div라면    HTML 페이지는 이런 형태가 될 것입니다.  &lt;!DOCTYPE html&gt; &lt;html lang="ko"&gt;  &lt;head&gt;   &lt;meta charset="UTF-8"&gt;   &lt;title&gt;Do...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/spring-boot-%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0security-3-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EB%B0%8F-%EA%B6%8C%ED%95%9C-%EC%A0%95%EB%B3%B4%EB%A5%BC-db%EC%97%90%EC%84%9C-%EA%B0%80%EC%A0%B8%EC%98%A4/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1560092400"
  data-df="ll"
  
>
  Jun 10, 2019
</time>

              <h4 class="pt-0 my-2">Spring Boot: 시큐리티(Security) - 3 - 로그인 및 권한 정보를 DB에서 가져오기</h4>
              <div class="text-muted">
                <p>깃허브에서 전체 코드 보기     https://github.com/ayaysir/spring-boot-security-example-1   이전 글에서는 기초를 익히기 위해 사용자 및 권한 정보를 inMemoryAuthentication이라 해서 메모리에 하드코딩 했었는데요, 이것을 데이터베이스에 옮겨서 가져오도록 하겠습니다.  데이터베이스는 mar...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/spring-boot-%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0security-2-%EC%BB%A4%EC%8A%A4%ED%85%80-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%A7%8C%EB%93%A4%EA%B8%B0/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1560092400"
  data-df="ll"
  
>
  Jun 10, 2019
</time>

              <h4 class="pt-0 my-2">Spring Boot: 시큐리티(Security) – 2 – 커스텀 로그인 페이지 만들기</h4>
              <div class="text-muted">
                <p>절차  1. SecurityConfig 클래스의 configure(http) 에 다음 내용을 추가합니다.  .formLogin().loginPage("/login").failureUrl("/login?error").permitAll() //  .logout().logoutRequestMatcher(new AntPathRequestMatcher("/lo...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-spring-boot-mp3%EC%9D%84-%EC%A0%84%EC%86%A1%ED%95%98%EB%8A%94-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC-%ED%81%AC%EB%A1%AC-%EB%B0%8F-%EC%82%AC%ED%8C%8C/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>스프링 부트 (Spring Boot): mp3을 전송하는 컨트롤러 - 크롬 및 사파리(Safari) 브라우저에서 구간 탐색이 안되는 문제 해결 방법</p>
    </a>
  

  
    <a
      href="/posts/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%98-tbody-%EB%82%B4%EC%9A%A9-%EB%92%A4%EC%A7%91%EA%B8%B0reverse/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>자바스크립트: 테이블의 tbody 내용 뒤집기(reverse)</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2026</time>

    
      <a href="https://github.com/ayaysir">ayaysir</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.3.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/audiokit/">AudioKit</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9D%8C%ED%96%A5%EC%9D%B4%EB%A1%A0/">음향이론</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/swift/">swift</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/java/">java</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8/">자바스크립트</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/spring-boot/">spring-boot</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vue-js/">vue-js</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9E%90%EB%B0%94/">자바</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/qbasic-%EA%B8%B0%EC%B4%88/">qbasic-기초</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script>
  (function () {
    const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed');
    const initTheme = themeMapper[Theme.visualState];

    let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) {
      lang = lang.slice(0, 2);
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'ayaysir/ayaysir.github.io',
      'data-repo-id': 'R_kgDOOurl2w',
      'data-category': 'General',
      'data-category-id': 'DIC_kwDOOurl284CxFIa',
      'data-mapping': 'pathname',
      'data-strict' : '0',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': lang,
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusNode = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusNode.setAttribute(key, value)
    );

    const $footer = document.querySelector('footer');
    $footer.insertAdjacentElement("beforebegin", giscusNode);

    addEventListener('message', (event) => {
      if (event.source === window && event.data && event.data.id === Theme.ID) {
        const newTheme = themeMapper[Theme.visualState];

        const message = {
          setConfig: {
            theme: newTheme
          }
        };

        const giscus =
          document.getElementsByClassName('giscus-frame')[0].contentWindow;
        giscus.postMessage({ giscus: message }, 'https://giscus.app');
      }
    });
  })();
</script>



    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

